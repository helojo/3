<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Shiro集成SSM基于URL权限管理(一)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Shiro集成SSM基于URL权限管理(一)</center></div><div class='banquan'>原文出处:本文由博客园博主Kaspar_Choo提供。<br/>
原文连接:https://www.cnblogs.com/kaspar/p/11648276.html</div><br>
    <p><span style="font-family: 宋体;">学习了</span>shiro<span style="font-family: 宋体;">之后，我们就可以说尝试把</span><span style="font-family: Calibri;">shiro</span><span style="font-family: 宋体;">加入</span><span style="font-family: Calibri;">ssm</span><span style="font-family: 宋体;">中，并做一套基于</span><span style="font-family: Calibri;">URL</span><span style="font-family: 宋体;">的权限管理。</span></p>
<p>其他的准备工作就不多说了，直接动手操作，看到效果再去理解。</p>
<h2><span style="font-family: Helvetica;">表结构</span></h2>
<p><strong>执行如下，数据库名字可以自行修改，不过要和自己手动创建的数据库名字以及之后代码中的数据库名字保持一致。</strong></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('314770c0-e6f5-479d-bc80-66c7f55077c5')"><img id="code_img_closed_314770c0-e6f5-479d-bc80-66c7f55077c5" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_314770c0-e6f5-479d-bc80-66c7f55077c5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('314770c0-e6f5-479d-bc80-66c7f55077c5',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_314770c0-e6f5-479d-bc80-66c7f55077c5" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">DROP DATABASE IF EXISTS shiro;
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">CREATE DATABASE shiro DEFAULT CHARACTER SET utf8;
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">USE shiro;
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">&nbsp;&nbsp;&nbsp;
</span><span style="color: #008080;"> 5</span> drop table <span style="color: #0000ff;">if</span><span style="color: #000000;"> exists user;
</span><span style="color: #008080;"> 6</span> drop table <span style="color: #0000ff;">if</span><span style="color: #000000;"> exists role;
</span><span style="color: #008080;"> 7</span> drop table <span style="color: #0000ff;">if</span><span style="color: #000000;"> exists permission;
</span><span style="color: #008080;"> 8</span> drop table <span style="color: #0000ff;">if</span><span style="color: #000000;"> exists user_role;
</span><span style="color: #008080;"> 9</span> drop table <span style="color: #0000ff;">if</span><span style="color: #000000;"> exists role_permission;
</span><span style="color: #008080;">10</span> <span style="color: #000000;">&nbsp;&nbsp;&nbsp;
</span><span style="color: #008080;">11</span> <span style="color: #000000;">create table user (
</span><span style="color: #008080;">12</span> <span style="color: #000000;">&nbsp;&nbsp;id bigint auto_increment,
</span><span style="color: #008080;">13</span> &nbsp;&nbsp;name varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">14</span> &nbsp;&nbsp;password varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">15</span> &nbsp;&nbsp;salt varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">16</span> <span style="color: #000000;">&nbsp;&nbsp;constraint pk_users primary key(id)
</span><span style="color: #008080;">17</span> ) charset=utf8 ENGINE=<span style="color: #000000;">InnoDB;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">&nbsp;&nbsp;&nbsp;
</span><span style="color: #008080;">19</span> <span style="color: #000000;">create table role (
</span><span style="color: #008080;">20</span> <span style="color: #000000;">&nbsp;&nbsp;id bigint auto_increment,
</span><span style="color: #008080;">21</span> &nbsp;&nbsp;name varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">22</span> &nbsp;&nbsp;desc_ varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">23</span> <span style="color: #000000;">&nbsp;&nbsp;constraint pk_roles primary key(id)
</span><span style="color: #008080;">24</span> ) charset=utf8 ENGINE=<span style="color: #000000;">InnoDB;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">&nbsp;&nbsp;&nbsp;
</span><span style="color: #008080;">26</span> <span style="color: #000000;">create table permission (
</span><span style="color: #008080;">27</span> <span style="color: #000000;">&nbsp;&nbsp;id bigint auto_increment,
</span><span style="color: #008080;">28</span> &nbsp;&nbsp;name varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">29</span> &nbsp;&nbsp;desc_ varchar(100<span style="color: #000000;">),
</span><span style="color: #008080;">30</span> &nbsp;&nbsp;url varchar(100<span style="color: #000000;">),&nbsp;
</span><span style="color: #008080;">31</span> <span style="color: #000000;">&nbsp;&nbsp;constraint pk_permissions primary key(id)
</span><span style="color: #008080;">32</span> ) charset=utf8 ENGINE=<span style="color: #000000;">InnoDB;
</span><span style="color: #008080;">33</span> <span style="color: #000000;">&nbsp;&nbsp;&nbsp;
</span><span style="color: #008080;">34</span> <span style="color: #000000;">create table user_role (
</span><span style="color: #008080;">35</span> <span style="color: #000000;">&nbsp;&nbsp;id bigint auto_increment,
</span><span style="color: #008080;">36</span> <span style="color: #000000;">&nbsp;&nbsp;uid bigint,
</span><span style="color: #008080;">37</span> <span style="color: #000000;">&nbsp;&nbsp;rid bigint,
</span><span style="color: #008080;">38</span> <span style="color: #000000;">&nbsp;&nbsp;constraint pk_users_roles primary key(id)
</span><span style="color: #008080;">39</span> ) charset=utf8 ENGINE=<span style="color: #000000;">InnoDB;
</span><span style="color: #008080;">40</span> <span style="color: #000000;">&nbsp;&nbsp;&nbsp;
</span><span style="color: #008080;">41</span> <span style="color: #000000;">create table role_permission (
</span><span style="color: #008080;">42</span> <span style="color: #000000;">&nbsp;&nbsp;id bigint auto_increment,
</span><span style="color: #008080;">43</span> <span style="color: #000000;">&nbsp;&nbsp;rid bigint,
</span><span style="color: #008080;">44</span> <span style="color: #000000;">&nbsp;&nbsp;pid bigint,
</span><span style="color: #008080;">45</span> <span style="color: #000000;">&nbsp;&nbsp;constraint pk_roles_permissions primary key(id)
</span><span style="color: #008080;">46</span> ) charset=utf8 ENGINE=InnoDB;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2><span style="font-family: Helvetica;">表数据</span></h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('af941510-bf13-4d93-aea0-c81d9d653cce')"><img id="code_img_closed_af941510-bf13-4d93-aea0-c81d9d653cce" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_af941510-bf13-4d93-aea0-c81d9d653cce" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('af941510-bf13-4d93-aea0-c81d9d653cce',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_af941510-bf13-4d93-aea0-c81d9d653cce" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> INSERT INTO `permission` VALUES (1,'addProduct','增加产品','/addProduct'<span style="color: #000000;">);
</span><span style="color: #008080;"> 2</span> INSERT INTO `permission` VALUES (2,'deleteProduct','删除产品','/deleteProduct'<span style="color: #000000;">);
</span><span style="color: #008080;"> 3</span> INSERT INTO `permission` VALUES (3,'editeProduct','编辑产品','/editeProduct'<span style="color: #000000;">);
</span><span style="color: #008080;"> 4</span> INSERT INTO `permission` VALUES (4,'updateProduct','修改产品','/updateProduct'<span style="color: #000000;">);
</span><span style="color: #008080;"> 5</span> INSERT INTO `permission` VALUES (5,'listProduct','查看产品','/listProduct'<span style="color: #000000;">);
</span><span style="color: #008080;"> 6</span> INSERT INTO `permission` VALUES (6,'addOrder','增加订单','/addOrder'<span style="color: #000000;">);
</span><span style="color: #008080;"> 7</span> INSERT INTO `permission` VALUES (7,'deleteOrder','删除订单','/deleteOrder'<span style="color: #000000;">);
</span><span style="color: #008080;"> 8</span> INSERT INTO `permission` VALUES (8,'editeOrder','编辑订单','/editeOrder'<span style="color: #000000;">);
</span><span style="color: #008080;"> 9</span> INSERT INTO `permission` VALUES (9,'updateOrder','修改订单','/updateOrder'<span style="color: #000000;">);
</span><span style="color: #008080;">10</span> INSERT INTO `permission` VALUES (10,'listOrder','查看订单','/listOrder'<span style="color: #000000;">);
</span><span style="color: #008080;">11</span> INSERT INTO `role` VALUES (1,'admin','超级管理员'<span style="color: #000000;">);
</span><span style="color: #008080;">12</span> INSERT INTO `role` VALUES (2,'productManager','产品管理员'<span style="color: #000000;">);
</span><span style="color: #008080;">13</span> INSERT INTO `role` VALUES (3,'orderManager','订单管理员'<span style="color: #000000;">);
</span><span style="color: #008080;">14</span> INSERT INTO `role_permission` VALUES (1,1,1<span style="color: #000000;">);
</span><span style="color: #008080;">15</span> INSERT INTO `role_permission` VALUES (2,1,2<span style="color: #000000;">);
</span><span style="color: #008080;">16</span> INSERT INTO `role_permission` VALUES (3,1,3<span style="color: #000000;">);
</span><span style="color: #008080;">17</span> INSERT INTO `role_permission` VALUES (4,1,4<span style="color: #000000;">);
</span><span style="color: #008080;">18</span> INSERT INTO `role_permission` VALUES (5,1,5<span style="color: #000000;">);
</span><span style="color: #008080;">19</span> INSERT INTO `role_permission` VALUES (6,1,6<span style="color: #000000;">);
</span><span style="color: #008080;">20</span> INSERT INTO `role_permission` VALUES (7,1,7<span style="color: #000000;">);
</span><span style="color: #008080;">21</span> INSERT INTO `role_permission` VALUES (8,1,8<span style="color: #000000;">);
</span><span style="color: #008080;">22</span> INSERT INTO `role_permission` VALUES (9,1,9<span style="color: #000000;">);
</span><span style="color: #008080;">23</span> INSERT INTO `role_permission` VALUES (10,1,10<span style="color: #000000;">);
</span><span style="color: #008080;">24</span> INSERT INTO `role_permission` VALUES (11,2,1<span style="color: #000000;">);
</span><span style="color: #008080;">25</span> INSERT INTO `role_permission` VALUES (12,2,2<span style="color: #000000;">);
</span><span style="color: #008080;">26</span> INSERT INTO `role_permission` VALUES (13,2,3<span style="color: #000000;">);
</span><span style="color: #008080;">27</span> INSERT INTO `role_permission` VALUES (14,2,4<span style="color: #000000;">);
</span><span style="color: #008080;">28</span> INSERT INTO `role_permission` VALUES (15,2,5<span style="color: #000000;">);
</span><span style="color: #008080;">29</span> INSERT INTO `role_permission` VALUES (50,3,10<span style="color: #000000;">);
</span><span style="color: #008080;">30</span> INSERT INTO `role_permission` VALUES (51,3,9<span style="color: #000000;">);
</span><span style="color: #008080;">31</span> INSERT INTO `role_permission` VALUES (52,3,8<span style="color: #000000;">);
</span><span style="color: #008080;">32</span> INSERT INTO `role_permission` VALUES (53,3,7<span style="color: #000000;">);
</span><span style="color: #008080;">33</span> INSERT INTO `role_permission` VALUES (54,3,6<span style="color: #000000;">);
</span><span style="color: #008080;">34</span> INSERT INTO `role_permission` VALUES (55,3,1<span style="color: #000000;">);
</span><span style="color: #008080;">35</span> INSERT INTO `role_permission` VALUES (56,5,11<span style="color: #000000;">);
</span><span style="color: #008080;">36</span> INSERT INTO `user` VALUES (1,'zhang3','a7d59dfc5332749cb801f86a24f5f590','e5ykFiNwShfCXvBRPr3wXg=='<span style="color: #000000;">);
</span><span style="color: #008080;">37</span> INSERT INTO `user` VALUES (2,'li4','43e28304197b9216e45ab1ce8dac831b','jPz19y7arvYIGhuUjsb6sQ=='<span style="color: #000000;">);
</span><span style="color: #008080;">38</span> INSERT INTO `user_role` VALUES (43,2,2<span style="color: #000000;">);
</span><span style="color: #008080;">39</span> INSERT INTO `user_role` VALUES (45,1,1);</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>&nbsp;<span style="font-family: Consolas;">和我们正常创建</span>ssm项目，一样。</p>
<h2>web.xml</h2>
<p>web.xml做了如下几件事情</p>
<p>1. 指定spring的配置文件有两个</p>
<p>applicationContext.xml： 用于链接数据库的</p>
<p>applicationContext-shiro.xml： 用于配置shiro的。</p>
<p>2. 指定springmvc的配置文件</p>
<p>springMVC.xml</p>
<p>3. 使用shiro过滤器</p>
<p>&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;</p>
<p><span style="font-family: Helvetica;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('48c8f189-77fa-46f8-a27c-b163057230c7')"><img id="code_img_closed_48c8f189-77fa-46f8-a27c-b163057230c7" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_48c8f189-77fa-46f8-a27c-b163057230c7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('48c8f189-77fa-46f8-a27c-b163057230c7',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_48c8f189-77fa-46f8-a27c-b163057230c7" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span style="color: #008080;"> 2</span> &lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
<span style="color: #008080;"> 3</span>          xmlns="http://java.sun.com/xml/ns/javaee"
<span style="color: #008080;"> 4</span>          xmlns:web="http://java.sun.com/xml/ns/javaee"
<span style="color: #008080;"> 5</span>          xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"&gt;
<span style="color: #008080;"> 6</span>      
<span style="color: #008080;"> 7</span>     &lt;!-- 中文过滤器 --&gt;
<span style="color: #008080;"> 8</span>     &lt;filter&gt;
<span style="color: #008080;"> 9</span>         &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;
<span style="color: #008080;">10</span>         &lt;filter-<span style="color: #0000ff;">class</span>&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-<span style="color: #0000ff;">class</span>&gt;
<span style="color: #008080;">11</span>         &lt;init-param&gt;
<span style="color: #008080;">12</span>             &lt;param-name&gt;encoding&lt;/param-name&gt;
<span style="color: #008080;">13</span>             &lt;param-value&gt;utf-8&lt;/param-value&gt;
<span style="color: #008080;">14</span>         &lt;/init-param&gt;
<span style="color: #008080;">15</span>     &lt;/filter&gt;
<span style="color: #008080;">16</span>     &lt;filter-mapping&gt;
<span style="color: #008080;">17</span>         &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;
<span style="color: #008080;">18</span>         &lt;url-pattern&gt;<span style="color: #008000;">/*</span><span style="color: #008000;">&lt;/url-pattern&gt;
</span><span style="color: #008080;">19</span> <span style="color: #008000;">    &lt;/filter-mapping&gt;
</span><span style="color: #008080;">20</span>          
<span style="color: #008080;">21</span> <span style="color: #008000;">    &lt;!-- spring的配置文件--&gt;
</span><span style="color: #008080;">22</span> <span style="color: #008000;">    &lt;context-param&gt;
</span><span style="color: #008080;">23</span> <span style="color: #008000;">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
</span><span style="color: #008080;">24</span> <span style="color: #008000;">        &lt;param-value&gt;
</span><span style="color: #008080;">25</span> <span style="color: #008000;">            classpath:applicationContext.xml,
</span><span style="color: #008080;">26</span> <span style="color: #008000;">            classpath:applicationContext-shiro.xml
</span><span style="color: #008080;">27</span> <span style="color: #008000;">        &lt;/param-value&gt;
</span><span style="color: #008080;">28</span> <span style="color: #008000;">    &lt;/context-param&gt;
</span><span style="color: #008080;">29</span> <span style="color: #008000;">    &lt;listener&gt;
</span><span style="color: #008080;">30</span> <span style="color: #008000;">        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
</span><span style="color: #008080;">31</span> <span style="color: #008000;">    &lt;/listener&gt;
</span><span style="color: #008080;">32</span>      
<span style="color: #008080;">33</span> <span style="color: #008000;">    &lt;!-- spring mvc核心：分发servlet --&gt;
</span><span style="color: #008080;">34</span> <span style="color: #008000;">    &lt;servlet&gt;
</span><span style="color: #008080;">35</span> <span style="color: #008000;">        &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt;
</span><span style="color: #008080;">36</span> <span style="color: #008000;">        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
</span><span style="color: #008080;">37</span> <span style="color: #008000;">        &lt;!-- spring mvc的配置文件 --&gt;
</span><span style="color: #008080;">38</span> <span style="color: #008000;">        &lt;init-param&gt;
</span><span style="color: #008080;">39</span> <span style="color: #008000;">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
</span><span style="color: #008080;">40</span> <span style="color: #008000;">            &lt;param-value&gt;classpath:springMVC.xml&lt;/param-value&gt;
</span><span style="color: #008080;">41</span> <span style="color: #008000;">        &lt;/init-param&gt;
</span><span style="color: #008080;">42</span> <span style="color: #008000;">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
</span><span style="color: #008080;">43</span> <span style="color: #008000;">    &lt;/servlet&gt;
</span><span style="color: #008080;">44</span> <span style="color: #008000;">    &lt;servlet-mapping&gt;
</span><span style="color: #008080;">45</span> <span style="color: #008000;">        &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt;
</span><span style="color: #008080;">46</span> <span style="color: #008000;">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
</span><span style="color: #008080;">47</span> <span style="color: #008000;">    &lt;/servlet-mapping&gt;
</span><span style="color: #008080;">48</span>      
<span style="color: #008080;">49</span> <span style="color: #008000;">    &lt;!-- Shiro配置 --&gt;
</span><span style="color: #008080;">50</span> <span style="color: #008000;">    &lt;filter&gt;
</span><span style="color: #008080;">51</span> <span style="color: #008000;">        &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;
</span><span style="color: #008080;">52</span> <span style="color: #008000;">        &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
</span><span style="color: #008080;">53</span> <span style="color: #008000;">        &lt;init-param&gt;
</span><span style="color: #008080;">54</span> <span style="color: #008000;">            &lt;param-name&gt;targetFilterLifecycle&lt;/param-name&gt;
</span><span style="color: #008080;">55</span> <span style="color: #008000;">            &lt;param-value&gt;true&lt;/param-value&gt;
</span><span style="color: #008080;">56</span> <span style="color: #008000;">        &lt;/init-param&gt;
</span><span style="color: #008080;">57</span> <span style="color: #008000;">    &lt;/filter&gt;
</span><span style="color: #008080;">58</span> <span style="color: #008000;">    &lt;filter-mapping&gt;
</span><span style="color: #008080;">59</span> <span style="color: #008000;">        &lt;filter-name&gt;shiroFilter&lt;/filter-name&gt;
</span><span style="color: #008080;">60</span> <span style="color: #008000;">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</span><span style="color: #008080;">61</span> <span style="color: #008000;">    &lt;/filter-mapping&gt;
</span><span style="color: #008080;">62</span>      
<span style="color: #008080;">63</span> <span style="color: #008000;">&lt;/web-app&gt;</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>applicationContext.xml</h2>
<p><span style="font-family: Helvetica;">1.配置数据库的相关信息</span><span style="font-family: 宋体;">（</span><span style="font-family: 宋体;">这些配置根据自己的需要自行修改</span><span style="font-family: 宋体;">）</span><br />2. 扫描mybatis的mapper<span style="font-family: 宋体;">之类的</span></p>
<p><span style="font-family: 宋体;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0ce4a5c9-638c-43dc-b915-6e2a47eb4153')"><img id="code_img_closed_0ce4a5c9-638c-43dc-b915-6e2a47eb4153" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_0ce4a5c9-638c-43dc-b915-6e2a47eb4153" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0ce4a5c9-638c-43dc-b915-6e2a47eb4153',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_0ce4a5c9-638c-43dc-b915-6e2a47eb4153" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span style="color: #008080;"> 2</span> &lt;beans xmlns="http://www.springframework.org/schema/beans"
<span style="color: #008080;"> 3</span>     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
<span style="color: #008080;"> 4</span>     xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jdbc="http://www.springframework.org/schema/jdbc"
<span style="color: #008080;"> 5</span>     xmlns:context="http://www.springframework.org/schema/context"
<span style="color: #008080;"> 6</span>     xmlns:mvc="http://www.springframework.org/schema/mvc"
<span style="color: #008080;"> 7</span>     xsi:schemaLocation=<span style="color: #000000;">"
</span><span style="color: #008080;"> 8</span>      http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/context </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span style="color: #008080;"> 9</span>      http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/beans </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span style="color: #008080;">10</span>      http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/jdbc </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd</span>
<span style="color: #008080;">11</span>      http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/tx </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span>
<span style="color: #008080;">12</span>      http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/aop </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span>
<span style="color: #008080;">13</span>      http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/mvc </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/mvc/spring-mvc.xsd</span><span style="color: #008000;">"&gt;</span>
<span style="color: #008080;">14</span>     
<span style="color: #008080;">15</span>     
<span style="color: #008080;">16</span>     
<span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>    &lt;context:annotation-config /&gt;
<span style="color: #008080;">19</span>     &lt;context:component-scan base-<span style="color: #0000ff;">package</span>="com.how2java.service" /&gt;
<span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span>     &lt;bean id="dataSource" <span style="color: #0000ff;">class</span>="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;  
<span style="color: #008080;">22</span>       &lt;property name="driverClassName"&gt;  
<span style="color: #008080;">23</span>           &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;  
<span style="color: #008080;">24</span>       &lt;/property&gt;  
<span style="color: #008080;">25</span>       &lt;property name="url"&gt;  
<span style="color: #008080;">26</span>           &lt;value&gt;jdbc:mysql:<span style="color: #008000;">//</span><span style="color: #008000;">localhost:3306/shiroweb?characterEncoding=UTF-8&lt;/value&gt;  </span>
<span style="color: #008080;">27</span>     
<span style="color: #008080;">28</span>       &lt;/property&gt;  
<span style="color: #008080;">29</span>       &lt;property name="username"&gt;  
<span style="color: #008080;">30</span>           &lt;value&gt;root&lt;/value&gt;  
<span style="color: #008080;">31</span>       &lt;/property&gt;  
<span style="color: #008080;">32</span>       &lt;property name="password"&gt;  
<span style="color: #008080;">33</span>           &lt;value&gt;root&lt;/value&gt;  
<span style="color: #008080;">34</span>       &lt;/property&gt;      
<span style="color: #008080;">35</span>     &lt;/bean&gt;
<span style="color: #008080;">36</span>     
<span style="color: #008080;">37</span>     
<span style="color: #008080;">38</span>     &lt;bean id="sqlSession" <span style="color: #0000ff;">class</span>="org.mybatis.spring.SqlSessionFactoryBean"&gt;
<span style="color: #008080;">39</span>         &lt;property name="typeAliasesPackage" value="com.how2java.pojo" /&gt;
<span style="color: #008080;">40</span>         &lt;property name="dataSource" ref="dataSource"/&gt;
<span style="color: #008080;">41</span>         &lt;property name="mapperLocations" value="classpath:com/how2java/mapper/*.xml"/&gt;
<span style="color: #008080;">42</span>     &lt;/bean&gt;
<span style="color: #008080;">43</span> 
<span style="color: #008080;">44</span>     &lt;bean <span style="color: #0000ff;">class</span>="org.mybatis.spring.mapper.MapperScannerConfigurer"&gt;
<span style="color: #008080;">45</span>         &lt;property name="basePackage" value="com.how2java.mapper"/&gt;
<span style="color: #008080;">46</span>     &lt;/bean&gt;
<span style="color: #008080;">47</span>     
<span style="color: #008080;">48</span> 
<span style="color: #008080;">49</span> 
<span style="color: #008080;">50</span> &lt;/beans&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>applicationContext-shiro.xml</h2>
<p><span style="font-family: Helvetica;">提供</span>shiro的相关配置，简单的说，就是把<span style="font-family: 宋体;">我们之前做练习的</span>shiro.ini里的内容搬到这个xml文件里面来了，只是写法不同<span style="font-family: 宋体;">。</span></p>
<p><span style="font-family: Helvetica;">配合</span>DatabaseRealm,做了&nbsp;shiro教程中的shiro.ini&nbsp;中做的事情<br /><span style="font-family: Helvetica;">设置密码匹配器</span></p>
<p>&lt;!-- 密码匹配器 --&gt;</p>
<p>&lt;bean id="credentialsMatcher" class="org.apache.shiro.authc.credential.HashedCredentialsMatcher"&gt;</p>
<p>&lt;property name="hashAlgorithmName" value="md5"/&gt;</p>
<p>&lt;property name="hashIterations" value="2"/&gt;</p>
<p>&lt;property name="storedCredentialsHexEncoded" value="true"/&gt;</p>
<p>&lt;/bean&gt;</p>
<p><br /><span style="font-family: Helvetica;">让</span>DatabaseRealm使用这个密码匹配器</p>
<p>&lt;bean id="databaseRealm" class="com.how2java.realm.DatabaseRealm"&gt;</p>
<p>&lt;property name="credentialsMatcher" ref="credentialsMatcher"/&gt;</p>
<p>&lt;/bean&gt;</p>
<p>&nbsp;<span style="font-family: 宋体;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('03eb76d3-88cb-4557-beb3-2a5f53eecaa8')"><img id="code_img_closed_03eb76d3-88cb-4557-beb3-2a5f53eecaa8" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_03eb76d3-88cb-4557-beb3-2a5f53eecaa8" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('03eb76d3-88cb-4557-beb3-2a5f53eecaa8',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_03eb76d3-88cb-4557-beb3-2a5f53eecaa8" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">  1</span> &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span style="color: #008080;">  2</span> &lt;beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
<span style="color: #008080;">  3</span>     xmlns="http://www.springframework.org/schema/beans" xmlns:util="http://www.springframework.org/schema/util"
<span style="color: #008080;">  4</span>     xmlns:context="http://www.springframework.org/schema/context" xmlns:p="http://www.springframework.org/schema/p"
<span style="color: #008080;">  5</span>     xmlns:tx="http://www.springframework.org/schema/tx" xmlns:mvc="http://www.springframework.org/schema/mvc"
<span style="color: #008080;">  6</span>     xmlns:aop="http://www.springframework.org/schema/aop"
<span style="color: #008080;">  7</span>     xsi:schemaLocation="http://www.springframework.org/schema/beans
<span style="color: #008080;">  8</span>     http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/beans/spring-beans-4.0.xsd </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/tx</span>
<span style="color: #008080;">  9</span>     http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/tx/spring-tx-4.0.xsd </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/context</span>
<span style="color: #008080;"> 10</span>     http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/context/spring-context-4.0.xsd </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/mvc</span>
<span style="color: #008080;"> 11</span>     http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/mvc/spring-mvc.xsd </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/aop</span>
<span style="color: #008080;"> 12</span>     http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/aop/spring-aop-4.0.xsd </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/util</span>
<span style="color: #008080;"> 13</span>     http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/util/spring-util.xsd"&gt;</span>
<span style="color: #008080;"> 14</span>      
<span style="color: #008080;"> 15</span>     &lt;!-- 配置shiro的过滤器工厂类，id- shiroFilter要和我们在web.xml中配置的过滤器一致 --&gt;
<span style="color: #008080;"> 16</span>     &lt;bean id="shiroFilter" <span style="color: #0000ff;">class</span>="org.apache.shiro.spring.web.ShiroFilterFactoryBean"&gt;
<span style="color: #008080;"> 17</span>         &lt;!-- 调用我们配置的权限管理器 --&gt;
<span style="color: #008080;"> 18</span>         &lt;property name="securityManager" ref="securityManager" /&gt;
<span style="color: #008080;"> 19</span>         &lt;!-- 配置我们的登录请求地址 --&gt;
<span style="color: #008080;"> 20</span>         &lt;property name="loginUrl" value="/login" /&gt;
<span style="color: #008080;"> 21</span>         &lt;!-- 如果您请求的资源不再您的权限范围，则跳转到/403请求地址 --&gt;
<span style="color: #008080;"> 22</span>         &lt;property name="unauthorizedUrl" value="/unauthorized" /&gt;
<span style="color: #008080;"> 23</span>         &lt;!-- 退出 --&gt;
<span style="color: #008080;"> 24</span>         &lt;property name="filters"&gt;
<span style="color: #008080;"> 25</span>             &lt;util:map&gt;
<span style="color: #008080;"> 26</span>                 &lt;entry key="logout" value-ref="logoutFilter" /&gt;
<span style="color: #008080;"> 27</span>             &lt;/util:map&gt;
<span style="color: #008080;"> 28</span>         &lt;/property&gt;
<span style="color: #008080;"> 29</span>         &lt;!-- 权限配置 --&gt;
<span style="color: #008080;"> 30</span>         &lt;property name="filterChainDefinitions"&gt;
<span style="color: #008080;"> 31</span>             &lt;value&gt;
<span style="color: #008080;"> 32</span>                 &lt;!-- anon表示此地址不需要任何权限即可访问 --&gt;
<span style="color: #008080;"> 33</span>                 /login=<span style="color: #000000;">anon
</span><span style="color: #008080;"> 34</span>                 /index=<span style="color: #000000;">anon
</span><span style="color: #008080;"> 35</span>                 /<span style="color: #0000ff;">static</span><span style="color: #008000;">/**</span><span style="color: #008000;">=anon
</span><span style="color: #008080;"> 36</span> <span style="color: #008000;">                &lt;!-- 只对业务功能进行权限管理，权限配置本身不需要没有做权限要求，这样做是为了不让初学者混淆 --&gt;
</span><span style="color: #008080;"> 37</span> <span style="color: #008000;">                /config/**=anon
</span><span style="color: #008080;"> 38</span> <span style="color: #008000;">                /doLogout=logout
</span><span style="color: #008080;"> 39</span> <span style="color: #008000;">                &lt;!--所有的请求(除去配置的静态资源请求或请求地址为anon的请求)都要通过登录验证,如果未登录则跳到/login --&gt;
</span><span style="color: #008080;"> 40</span> <span style="color: #008000;">                /** = authc
</span><span style="color: #008080;"> 41</span> <span style="color: #008000;">            &lt;/value&gt;
</span><span style="color: #008080;"> 42</span> <span style="color: #008000;">        &lt;/property&gt;
</span><span style="color: #008080;"> 43</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 44</span> <span style="color: #008000;">    &lt;!-- 退出过滤器 --&gt;
</span><span style="color: #008080;"> 45</span> <span style="color: #008000;">    &lt;bean id="logoutFilter" class="org.apache.shiro.web.filter.authc.LogoutFilter"&gt;
</span><span style="color: #008080;"> 46</span> <span style="color: #008000;">        &lt;property name="redirectUrl" value="/index" /&gt;
</span><span style="color: #008080;"> 47</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 48</span>  
<span style="color: #008080;"> 49</span> <span style="color: #008000;">    &lt;!-- 会话ID生成器 --&gt;
</span><span style="color: #008080;"> 50</span> <span style="color: #008000;">    &lt;bean id="sessionIdGenerator"
</span><span style="color: #008080;"> 51</span> <span style="color: #008000;">        class="org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator" /&gt;
</span><span style="color: #008080;"> 52</span> <span style="color: #008000;">    &lt;!-- 会话Cookie模板 关闭浏览器立即失效 --&gt;
</span><span style="color: #008080;"> 53</span> <span style="color: #008000;">    &lt;bean id="sessionIdCookie" class="org.apache.shiro.web.servlet.SimpleCookie"&gt;
</span><span style="color: #008080;"> 54</span> <span style="color: #008000;">        &lt;constructor-arg value="sid" /&gt;
</span><span style="color: #008080;"> 55</span> <span style="color: #008000;">        &lt;property name="httpOnly" value="true" /&gt;
</span><span style="color: #008080;"> 56</span> <span style="color: #008000;">        &lt;property name="maxAge" value="-1" /&gt;
</span><span style="color: #008080;"> 57</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 58</span> <span style="color: #008000;">    &lt;!-- 会话DAO --&gt;
</span><span style="color: #008080;"> 59</span> <span style="color: #008000;">    &lt;bean id="sessionDAO"
</span><span style="color: #008080;"> 60</span> <span style="color: #008000;">        class="org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO"&gt;
</span><span style="color: #008080;"> 61</span> <span style="color: #008000;">        &lt;property name="sessionIdGenerator" ref="sessionIdGenerator" /&gt;
</span><span style="color: #008080;"> 62</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 63</span> <span style="color: #008000;">    &lt;!-- 会话验证调度器，每30分钟执行一次验证 ，设定会话超时及保存 --&gt;
</span><span style="color: #008080;"> 64</span> <span style="color: #008000;">    &lt;bean name="sessionValidationScheduler"
</span><span style="color: #008080;"> 65</span> <span style="color: #008000;">        class="org.apache.shiro.session.mgt.ExecutorServiceSessionValidationScheduler"&gt;
</span><span style="color: #008080;"> 66</span> <span style="color: #008000;">        &lt;property name="interval" value="1800000" /&gt;
</span><span style="color: #008080;"> 67</span> <span style="color: #008000;">        &lt;property name="sessionManager" ref="sessionManager" /&gt;
</span><span style="color: #008080;"> 68</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 69</span> <span style="color: #008000;">    &lt;!-- 会话管理器 --&gt;
</span><span style="color: #008080;"> 70</span> <span style="color: #008000;">    &lt;bean id="sessionManager"
</span><span style="color: #008080;"> 71</span> <span style="color: #008000;">        class="org.apache.shiro.web.session.mgt.DefaultWebSessionManager"&gt;
</span><span style="color: #008080;"> 72</span> <span style="color: #008000;">        &lt;!-- 全局会话超时时间（单位毫秒），默认30分钟 --&gt;
</span><span style="color: #008080;"> 73</span> <span style="color: #008000;">        &lt;property name="globalSessionTimeout" value="1800000" /&gt;
</span><span style="color: #008080;"> 74</span> <span style="color: #008000;">        &lt;property name="deleteInvalidSessions" value="true" /&gt;
</span><span style="color: #008080;"> 75</span> <span style="color: #008000;">        &lt;property name="sessionValidationSchedulerEnabled" value="true" /&gt;
</span><span style="color: #008080;"> 76</span> <span style="color: #008000;">        &lt;property name="sessionValidationScheduler" ref="sessionValidationScheduler" /&gt;
</span><span style="color: #008080;"> 77</span> <span style="color: #008000;">        &lt;property name="sessionDAO" ref="sessionDAO" /&gt;
</span><span style="color: #008080;"> 78</span> <span style="color: #008000;">        &lt;property name="sessionIdCookieEnabled" value="true" /&gt;
</span><span style="color: #008080;"> 79</span> <span style="color: #008000;">        &lt;property name="sessionIdCookie" ref="sessionIdCookie" /&gt;
</span><span style="color: #008080;"> 80</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 81</span>  
<span style="color: #008080;"> 82</span> <span style="color: #008000;">    &lt;!-- 安全管理器 --&gt;
</span><span style="color: #008080;"> 83</span> <span style="color: #008000;">    &lt;bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager"&gt;
</span><span style="color: #008080;"> 84</span> <span style="color: #008000;">        &lt;property name="realm" ref="databaseRealm" /&gt;
</span><span style="color: #008080;"> 85</span> <span style="color: #008000;">        &lt;property name="sessionManager" ref="sessionManager" /&gt;
</span><span style="color: #008080;"> 86</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 87</span> <span style="color: #008000;">    &lt;!-- 相当于调用SecurityUtils.setSecurityManager(securityManager) --&gt;
</span><span style="color: #008080;"> 88</span> <span style="color: #008000;">    &lt;bean
</span><span style="color: #008080;"> 89</span> <span style="color: #008000;">        class="org.springframework.beans.factory.config.MethodInvokingFactoryBean"&gt;
</span><span style="color: #008080;"> 90</span> <span style="color: #008000;">        &lt;property name="staticMethod"
</span><span style="color: #008080;"> 91</span> <span style="color: #008000;">            value="org.apache.shiro.SecurityUtils.setSecurityManager" /&gt;
</span><span style="color: #008080;"> 92</span> <span style="color: #008000;">        &lt;property name="arguments" ref="securityManager" /&gt;
</span><span style="color: #008080;"> 93</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;"> 94</span>  
<span style="color: #008080;"> 95</span> <span style="color: #008000;">    &lt;!-- 密码匹配器 --&gt;
</span><span style="color: #008080;"> 96</span> <span style="color: #008000;">    &lt;bean id="credentialsMatcher" class="org.apache.shiro.authc.credential.HashedCredentialsMatcher"&gt;
</span><span style="color: #008080;"> 97</span> <span style="color: #008000;">        &lt;property name="hashAlgorithmName" value="md5"/&gt;
</span><span style="color: #008080;"> 98</span> <span style="color: #008000;">        &lt;property name="hashIterations" value="2"/&gt;
</span><span style="color: #008080;"> 99</span> <span style="color: #008000;">        &lt;property name="storedCredentialsHexEncoded" value="true"/&gt;
</span><span style="color: #008080;">100</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;">101</span>  
<span style="color: #008080;">102</span> <span style="color: #008000;">    &lt;bean id="databaseRealm" class="com.how2java.realm.DatabaseRealm"&gt;
</span><span style="color: #008080;">103</span> <span style="color: #008000;">        &lt;property name="credentialsMatcher" ref="credentialsMatcher"/&gt;
</span><span style="color: #008080;">104</span> <span style="color: #008000;">    &lt;/bean&gt;
</span><span style="color: #008080;">105</span>      
<span style="color: #008080;">106</span> <span style="color: #008000;">    &lt;!-- 保证实现了Shiro内部lifecycle函数的bean执行 --&gt;
</span><span style="color: #008080;">107</span> <span style="color: #008000;">    &lt;bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor" /&gt;
</span><span style="color: #008080;">108</span> <span style="color: #008000;">&lt;/beans&gt;</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>springMVC.xml</h2>
<p>1.springmvc的基本配置<br />2. 增加了对shiro的支持<br /><span style="font-family: Helvetica;">这样可以在控制器</span>Controller上，使用像@RequireRole 这样的注解，来表示某个方法必须有相关的角色才能访问<br />3. 指定了异常处理类DefaultExceptionHandler，这样当访问没有权限的资源的时候，就会跳到统一的页面去显示错误信息</p>
<p><span style="font-family: Helvetica;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('03333034-69f8-424d-9820-308d51aa90ed')"><img id="code_img_closed_03333034-69f8-424d-9820-308d51aa90ed" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_03333034-69f8-424d-9820-308d51aa90ed" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('03333034-69f8-424d-9820-308d51aa90ed',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_03333034-69f8-424d-9820-308d51aa90ed" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span style="color: #008080;"> 2</span> &lt;beans xmlns="http://www.springframework.org/schema/beans"
<span style="color: #008080;"> 3</span>     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
<span style="color: #008080;"> 4</span>     xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jdbc="http://www.springframework.org/schema/jdbc"
<span style="color: #008080;"> 5</span>     xmlns:context="http://www.springframework.org/schema/context"
<span style="color: #008080;"> 6</span>     xmlns:mvc="http://www.springframework.org/schema/mvc"
<span style="color: #008080;"> 7</span>     xsi:schemaLocation="http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd
<span style="color: #008080;"> 8</span>         http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/aop </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</span>
<span style="color: #008080;"> 9</span>         http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/beans </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span style="color: #008080;">10</span>         http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/context </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span style="color: #008080;">11</span>         http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/tx </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</span> 
<span style="color: #008080;">12</span>         http:<span style="color: #008000;">//</span><span style="color: #008000;">www.springframework.org/schema/mvc </span><span style="color: #008000; text-decoration: underline;">http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd</span><span style="color: #008000;">"&gt;</span>
<span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span>     &lt;context:annotation-config/&gt;
<span style="color: #008080;">17</span> 
<span style="color: #008080;">18</span>     &lt;context:component-scan base-<span style="color: #0000ff;">package</span>="com.how2java.controller"&gt;
<span style="color: #008080;">19</span>           &lt;context:include-filter type="annotation" 
<span style="color: #008080;">20</span>           expression="org.springframework.stereotype.Controller"/&gt;
<span style="color: #008080;">21</span>     &lt;/context:component-scan&gt;
<span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>     &lt;mvc:annotation-driven /&gt;
<span style="color: #008080;">24</span>     
<span style="color: #008080;">25</span>     &lt;mvc:<span style="color: #0000ff;">default</span>-servlet-handler /&gt;
<span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span>     &lt;<span style="color: #000000;">bean
</span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">class</span>="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
<span style="color: #008080;">30</span>         &lt;property name="viewClass"
<span style="color: #008080;">31</span>             value="org.springframework.web.servlet.view.JstlView" /&gt;
<span style="color: #008080;">32</span>         &lt;property name="prefix" value="/WEB-INF/jsp/" /&gt;
<span style="color: #008080;">33</span>         &lt;property name="suffix" value=".jsp" /&gt;
<span style="color: #008080;">34</span>     &lt;/bean&gt;
<span style="color: #008080;">35</span>     
<span style="color: #008080;">36</span>     &lt;!--启用shiro注解 --&gt;
<span style="color: #008080;">37</span>     &lt;<span style="color: #000000;">bean
</span><span style="color: #008080;">38</span>         <span style="color: #0000ff;">class</span>="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"
<span style="color: #008080;">39</span>         depends-on="lifecycleBeanPostProcessor"&gt;
<span style="color: #008080;">40</span>         &lt;property name="proxyTargetClass" value="true" /&gt;
<span style="color: #008080;">41</span>     &lt;/bean&gt;
<span style="color: #008080;">42</span>     &lt;<span style="color: #000000;">bean
</span><span style="color: #008080;">43</span>         <span style="color: #0000ff;">class</span>="org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor"&gt;
<span style="color: #008080;">44</span>         &lt;property name="securityManager" ref="securityManager" /&gt;
<span style="color: #008080;">45</span>     &lt;/bean&gt;
<span style="color: #008080;">46</span>     
<span style="color: #008080;">47</span>     &lt;!-- 控制器异常处理 --&gt;
<span style="color: #008080;">48</span>     &lt;bean id="exceptionHandlerExceptionResolver" <span style="color: #0000ff;">class</span>="org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver"&gt;
<span style="color: #008080;">49</span>     &lt;/bean&gt;
<span style="color: #008080;">50</span>     &lt;bean <span style="color: #0000ff;">class</span>="com.how2java.exception.DefaultExceptionHandler"/&gt;    
<span style="color: #008080;">51</span> 
<span style="color: #008080;">52</span> &lt;/beans&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>log4j.properties</h2>
<p><span style="font-family: 宋体;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('5776d7b8-68b6-4920-a9af-36994741dece')"><img id="code_img_closed_5776d7b8-68b6-4920-a9af-36994741dece" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_5776d7b8-68b6-4920-a9af-36994741dece" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('5776d7b8-68b6-4920-a9af-36994741dece',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_5776d7b8-68b6-4920-a9af-36994741dece" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;"># Global logging configuration
</span><span style="color: #008080;">2</span> log4j.rootLogger=<span style="color: #000000;">ERROR, stdout
</span><span style="color: #008080;">3</span> <span style="color: #000000;"># MyBatis logging configuration...
</span><span style="color: #008080;">4</span> log4j.logger.com.how2java=<span style="color: #000000;">TRACE
</span><span style="color: #008080;">5</span> <span style="color: #000000;"># Console output...
</span><span style="color: #008080;">6</span> log4j.appender.stdout=<span style="color: #000000;">org.apache.log4j.ConsoleAppender
</span><span style="color: #008080;">7</span> log4j.appender.stdout.layout=<span style="color: #000000;">org.apache.log4j.PatternLayout
</span><span style="color: #008080;">8</span> log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>PageController.java</h2>
<p><span style="font-family: Helvetica;">因为使用</span> ssm，所以jsp通常都会放在WEB-INF/jsp 下面，而这个位置是无法通过浏览器直接访问的，所以就会专门做这么一个类，便于访问这些jsp。<br /><span style="font-family: Helvetica;">比如要访问</span>WEB-INF/jsp/index.jsp文件，那么就通过/index 这个路径来访问。<br /><span style="font-family: Helvetica;">这个类还有两点需要注意：</span><br />1. /login 只支持get方式。 post方式是后续用来进行登录行为的，这里的get方式仅仅用于显示登录页面<br />2. 权限注解：<br /><span style="font-family: Helvetica;">通过注解：</span> @RequiresRoles("admin") 指明了 访问 deleteProduct 需要角色"admin"&nbsp;<br /><span style="font-family: Helvetica;">通过注解：</span>@RequiresPermissions("deleteOrder") 指明了 访问 deleteOrder 需要权限"deleteOrder"&nbsp;</p>
<p><span style="font-family: 宋体;">我们在哪里需要使用权限，就在哪里加上对应注解，但是当我们的权限配置关系发生改变的时候，我们不得不修改代码，这在实际项目中是不可能的。为了解决这一问题我们引入了</span>url<span style="font-family: 宋体;">配置权限。</span></p>
<p><span style="font-family: 宋体;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('42af3e3d-1f45-4c34-b7f9-c90edebb0504')"><img id="code_img_closed_42af3e3d-1f45-4c34-b7f9-c90edebb0504" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_42af3e3d-1f45-4c34-b7f9-c90edebb0504" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('42af3e3d-1f45-4c34-b7f9-c90edebb0504',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_42af3e3d-1f45-4c34-b7f9-c90edebb0504" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.controller;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authz.annotation.RequiresPermissions;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authz.annotation.RequiresRoles;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMethod;
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #008000;">//</span><span style="color: #008000;">专门用于显示页面的控制器</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">@Controller
</span><span style="color: #008080;">12</span> @RequestMapping(""<span style="color: #000000;">)
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> PageController {
</span><span style="color: #008080;">14</span>     
<span style="color: #008080;">15</span>     @RequestMapping("index"<span style="color: #000000;">)
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String index(){
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span> "index"<span style="color: #000000;">;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span>     
<span style="color: #008080;">20</span>     @RequiresPermissions("deleteOrder"<span style="color: #000000;">)
</span><span style="color: #008080;">21</span>     @RequestMapping("deleteOrder"<span style="color: #000000;">)
</span><span style="color: #008080;">22</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String deleteOrder(){
</span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">return</span> "deleteOrder"<span style="color: #000000;">;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">25</span>     @RequiresRoles("productManager"<span style="color: #000000;">)
</span><span style="color: #008080;">26</span>     @RequestMapping("deleteProduct"<span style="color: #000000;">)
</span><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String deleteProduct(){
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">return</span> "deleteProduct"<span style="color: #000000;">;
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">30</span>     @RequestMapping("listProduct"<span style="color: #000000;">)
</span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String listProduct(){
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">return</span> "listProduct"<span style="color: #000000;">;
</span><span style="color: #008080;">33</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">34</span>     
<span style="color: #008080;">35</span>     @RequestMapping(value="/login",method=<span style="color: #000000;">RequestMethod.GET)  
</span><span style="color: #008080;">36</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String login(){
</span><span style="color: #008080;">37</span>         <span style="color: #0000ff;">return</span> "login"<span style="color: #000000;">;
</span><span style="color: #008080;">38</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">39</span>     @RequestMapping("unauthorized"<span style="color: #000000;">)
</span><span style="color: #008080;">40</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String noPerms(){
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">return</span> "unauthorized"<span style="color: #000000;">;
</span><span style="color: #008080;">42</span>     }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2><strong>V</strong><strong>iew<span style="font-family: 宋体;">层的各个页面</span></strong></h2>
<p><strong><span style="font-family: 宋体;">直接贴出结构图和代码</span></strong></p>
<p><strong><span style="font-family: 宋体;"><img src="./images/Shiro集成SSM基于URL权限管理(一)16.png" alt="" /></span></strong></p>
<p>index页面</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('de72b279-4492-40e9-ad71-806be52f105c')"><img id="code_img_closed_de72b279-4492-40e9-ad71-806be52f105c" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_de72b279-4492-40e9-ad71-806be52f105c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('de72b279-4492-40e9-ad71-806be52f105c',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_de72b279-4492-40e9-ad71-806be52f105c" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> &lt;link rel="stylesheet" type="text/css" href="static/css/style.css" /&gt;
<span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> &lt;/head&gt;
<span style="color: #008080;">13</span> &lt;body&gt;
<span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">18</span>     &lt;div <span style="color: #0000ff;">class</span>="loginDiv"&gt;
<span style="color: #008080;">19</span>     
<span style="color: #008080;">20</span>     
<span style="color: #008080;">21</span> 
<span style="color: #008080;">22</span>     &lt;c:<span style="color: #0000ff;">if</span> test="${empty subject.principal}"&gt;
<span style="color: #008080;">23</span>         &lt;a href="login"&gt;登录&lt;/a&gt;&lt;br&gt;
<span style="color: #008080;">24</span>     &lt;/c:<span style="color: #0000ff;">if</span>&gt;
<span style="color: #008080;">25</span>     &lt;c:<span style="color: #0000ff;">if</span> test="${!empty subject.principal}"&gt;
<span style="color: #008080;">26</span>         &lt;span <span style="color: #0000ff;">class</span>="desc"&gt;你好，${subject.principal}，&lt;/span&gt;
<span style="color: #008080;">27</span>         &lt;a href="doLogout"&gt;退出&lt;/a&gt;&lt;br&gt;    
<span style="color: #008080;">28</span>     &lt;/c:<span style="color: #0000ff;">if</span>&gt;
<span style="color: #008080;">29</span>         
<span style="color: #008080;">30</span>     &lt;a href="listProduct"&gt;查看产品&lt;/a&gt;&lt;span <span style="color: #0000ff;">class</span>="desc"&gt;(登录后才可以查看) &lt;/span&gt;&lt;br&gt;
<span style="color: #008080;">31</span>     &lt;a href="deleteProduct"&gt;删除产品&lt;/a&gt;&lt;span  <span style="color: #0000ff;">class</span>="desc"&gt;(要有产品管理员角色, zhang3没有，li4 有) &lt;/span&gt;&lt;br&gt;
<span style="color: #008080;">32</span>     &lt;a href="deleteOrder"&gt;删除订单&lt;/a&gt;&lt;span <span style="color: #0000ff;">class</span>="desc"&gt;(要有删除订单权限, zhang3有，li4没有) &lt;/span&gt;&lt;br&gt;
<span style="color: #008080;">33</span> &lt;/div&gt;
<span style="color: #008080;">34</span> 
<span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span> 
<span style="color: #008080;">40</span> 
<span style="color: #008080;">41</span> 
<span style="color: #008080;">42</span> 
<span style="color: #008080;">43</span> &lt;/body&gt;
<span style="color: #008080;">44</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>login.jsp<span style="font-family: Helvetica;">登陆页面</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('2b943306-c1e0-43fb-8712-6f57b671c456')"><img id="code_img_closed_2b943306-c1e0-43fb-8712-6f57b671c456" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_2b943306-c1e0-43fb-8712-6f57b671c456" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2b943306-c1e0-43fb-8712-6f57b671c456',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_2b943306-c1e0-43fb-8712-6f57b671c456" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8" <span style="color: #0000ff;">import</span>="java.util.*"%&gt;
<span style="color: #008080;"> 3</span>  
<span style="color: #008080;"> 4</span> &lt;!DOCTYPE html&gt;
<span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 7</span> &lt;link rel="stylesheet" type="text/css" href="static/css/style.css" /&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>  
<span style="color: #008080;">10</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> &lt;div <span style="color: #0000ff;">class</span>="errorInfo"&gt;${error}&lt;/div&gt;
<span style="color: #008080;">13</span>     &lt;form action="login" method="post"&gt;
<span style="color: #008080;">14</span>         账号： &lt;input type="text" name="name"&gt; &lt;br&gt;
<span style="color: #008080;">15</span>         密码： &lt;input type="password" name="password"&gt; &lt;br&gt;
<span style="color: #008080;">16</span>         &lt;br&gt;
<span style="color: #008080;">17</span>         &lt;input type="submit" value="登录"&gt;
<span style="color: #008080;">18</span>         &lt;br&gt;
<span style="color: #008080;">19</span>         &lt;br&gt;
<span style="color: #008080;">20</span>     &lt;div&gt;
<span style="color: #008080;">21</span>         &lt;span <span style="color: #0000ff;">class</span>="desc"&gt;账号:zhang3 密码:12345 角色:admin&lt;/span&gt;&lt;br&gt;
<span style="color: #008080;">22</span>         &lt;span <span style="color: #0000ff;">class</span>="desc"&gt;账号:li4 密码:abcde 角色:productManager&lt;/span&gt;&lt;br&gt;
<span style="color: #008080;">23</span>     &lt;/div&gt;
<span style="color: #008080;">24</span>         
<span style="color: #008080;">25</span>         
<span style="color: #008080;">26</span>     &lt;/form&gt;
<span style="color: #008080;">27</span> &lt;/div&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>listProduct.jsp&nbsp;&nbsp;<span style="font-family: Helvetica;">需要登录才能访问的页面</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('109c3705-d4ec-4527-89d9-3777db71721f')"><img id="code_img_closed_109c3705-d4ec-4527-89d9-3777db71721f" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_109c3705-d4ec-4527-89d9-3777db71721f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('109c3705-d4ec-4527-89d9-3777db71721f',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_109c3705-d4ec-4527-89d9-3777db71721f" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8" <span style="color: #0000ff;">import</span>="java.util.*"%&gt;
<span style="color: #008080;"> 3</span>  
<span style="color: #008080;"> 4</span> &lt;!DOCTYPE html&gt;
<span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 7</span> &lt;link rel="stylesheet" type="text/css" href="static/css/style.css" /&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>  
<span style="color: #008080;">10</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #000000;">    listProduct.jsp ，能进来，就表示已经登录成功了
</span><span style="color: #008080;">13</span>     &lt;br&gt;
<span style="color: #008080;">14</span>     &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;
<span style="color: #008080;">15</span> &lt;/div&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>deleteProduct.jsp&nbsp;<span style="font-family: Helvetica;">需要角色才能访问的页面</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('caf8d887-a793-4f81-9c42-578935aa9bb1')"><img id="code_img_closed_caf8d887-a793-4f81-9c42-578935aa9bb1" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_caf8d887-a793-4f81-9c42-578935aa9bb1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('caf8d887-a793-4f81-9c42-578935aa9bb1',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_caf8d887-a793-4f81-9c42-578935aa9bb1" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8" <span style="color: #0000ff;">import</span>="java.util.*"%&gt;
<span style="color: #008080;"> 3</span>  
<span style="color: #008080;"> 4</span> &lt;!DOCTYPE html&gt;
<span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 7</span> &lt;link rel="stylesheet" type="text/css" href="static/css/style.css" /&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>  
<span style="color: #008080;">10</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span>     deleteProduct.jsp，能进来&lt;br&gt;<span style="color: #000000;">就表示拥有 productManager 角色
</span><span style="color: #008080;">13</span>     &lt;br&gt;
<span style="color: #008080;">14</span>     &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;
<span style="color: #008080;">15</span> &lt;/div&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>deleteOrder.jsp&nbsp;<span style="font-family: Helvetica;">需要权限</span>deleteOrder 才能访问的页面</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('9f416d81-20a7-41f8-b3aa-f9c951caae83')"><img id="code_img_closed_9f416d81-20a7-41f8-b3aa-f9c951caae83" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_9f416d81-20a7-41f8-b3aa-f9c951caae83" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9f416d81-20a7-41f8-b3aa-f9c951caae83',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_9f416d81-20a7-41f8-b3aa-f9c951caae83" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8" <span style="color: #0000ff;">import</span>="java.util.*"%&gt;
<span style="color: #008080;"> 3</span>  
<span style="color: #008080;"> 4</span> &lt;!DOCTYPE html&gt;
<span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 7</span> &lt;link rel="stylesheet" type="text/css" href="static/css/style.css" /&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #000000;">    deleteOrder.jsp ，能进来，就表示有deleteOrder权限
</span><span style="color: #008080;">12</span>     &lt;br&gt;
<span style="color: #008080;">13</span>     &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;
<span style="color: #008080;">14</span> &lt;/div&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>unauthorized.jsp<span style="font-family: Helvetica;">没有角色，没有权限都会跳转到这个页面来</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('73fab7b3-5839-48a3-a3e0-93136e25c0d1')"><img id="code_img_closed_73fab7b3-5839-48a3-a3e0-93136e25c0d1" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_73fab7b3-5839-48a3-a3e0-93136e25c0d1" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('73fab7b3-5839-48a3-a3e0-93136e25c0d1',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_73fab7b3-5839-48a3-a3e0-93136e25c0d1" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8" <span style="color: #0000ff;">import</span>="java.util.*"%&gt;
<span style="color: #008080;"> 3</span>  
<span style="color: #008080;"> 4</span> &lt;!DOCTYPE html&gt;
<span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 7</span> &lt;link rel="stylesheet" type="text/css" href="static/css/style.css" /&gt;
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>  
<span style="color: #008080;">10</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span>     
<span style="color: #008080;">13</span>     
<span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> <span style="color: #000000;">    权限不足,具体原因：${ex.message}
</span><span style="color: #008080;">16</span>     &lt;br&gt;
<span style="color: #008080;">17</span>     &lt;a href="#" onClick="javascript:history.back()"&gt;返回&lt;/a&gt;
<span style="color: #008080;">18</span> &lt;/div&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>menu.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('7cdb82c5-7441-4ed3-8903-2badc6a9125e')"><img id="code_img_closed_7cdb82c5-7441-4ed3-8903-2badc6a9125e" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_7cdb82c5-7441-4ed3-8903-2badc6a9125e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('7cdb82c5-7441-4ed3-8903-2badc6a9125e',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_7cdb82c5-7441-4ed3-8903-2badc6a9125e" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;">2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;">3</span>     &lt;div <span style="color: #0000ff;">class</span>="menu"&gt;
<span style="color: #008080;">4</span>         &lt;a href="listUser"&gt;用户管理&lt;/a&gt;
<span style="color: #008080;">5</span>         &lt;a href="listRole"&gt;角色管理&lt;/a&gt;
<span style="color: #008080;">6</span>         &lt;a href="listPermission"&gt;权限管理&lt;/a&gt;
<span style="color: #008080;">7</span>     &lt;/div&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>style.css</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('32960c9f-4bf9-45ac-bd90-2f88bc1d4e77')"><img id="code_img_closed_32960c9f-4bf9-45ac-bd90-2f88bc1d4e77" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_32960c9f-4bf9-45ac-bd90-2f88bc1d4e77" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('32960c9f-4bf9-45ac-bd90-2f88bc1d4e77',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_32960c9f-4bf9-45ac-bd90-2f88bc1d4e77" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">span.desc{
</span><span style="color: #008080;"> 2</span>     margin-<span style="color: #000000;">left:20px;
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">    color:gray;
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">div.workingroom{
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    margin:200px auto;
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    width:600px;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    position:relative;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">}
</span><span style="color: #008080;">10</span> <span style="color: #000000;">div.workingroom a{
</span><span style="color: #008080;">11</span> <span style="color: #008000;">/*</span><span style="color: #008000;">  display:inline-block; </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">12</span> <span style="color: #008000;">/*</span><span style="color: #008000;">  margin-top:20px; </span><span style="color: #008000;">*/</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">}
</span><span style="color: #008080;">14</span> <span style="color: #000000;">div.loginDiv{
</span><span style="color: #008080;">15</span>     text-<span style="color: #000000;">align: left;
</span><span style="color: #008080;">16</span> <span style="color: #000000;">}
</span><span style="color: #008080;">17</span> <span style="color: #000000;">div.errorInfo{
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    color:red;
</span><span style="color: #008080;">19</span>     font-size:0<span style="color: #000000;">.65em;
</span><span style="color: #008080;">20</span> <span style="color: #000000;">}
</span><span style="color: #008080;">21</span> <span style="color: #000000;">div.workingroom td{
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    border:1px solid black;
</span><span style="color: #008080;">23</span> <span style="color: #000000;">}
</span><span style="color: #008080;">24</span> <span style="color: #000000;">div.workingroom table{
</span><span style="color: #008080;">25</span>     border-<span style="color: #000000;">collapse:collapse;
</span><span style="color: #008080;">26</span>     width:100%<span style="color: #000000;">;
</span><span style="color: #008080;">27</span> <span style="color: #000000;">}
</span><span style="color: #008080;">28</span>  
<span style="color: #008080;">29</span> <span style="color: #000000;">div.workingroom td{
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    border:1px solid black;
</span><span style="color: #008080;">31</span> <span style="color: #000000;">}
</span><span style="color: #008080;">32</span>  
<span style="color: #008080;">33</span> <span style="color: #000000;">div.workingroom div.menu{
</span><span style="color: #008080;">34</span> <span style="color: #000000;">    position:absolute;
</span><span style="color: #008080;">35</span>     left:-<span style="color: #000000;">160px;
</span><span style="color: #008080;">36</span>     top:-<span style="color: #000000;">20px;
</span><span style="color: #008080;">37</span> <span style="color: #000000;">}
</span><span style="color: #008080;">38</span> <span style="color: #000000;">div.workingroom div.menu a{
</span><span style="color: #008080;">39</span> <span style="color: #000000;">    display:block;
</span><span style="color: #008080;">40</span>     margin-<span style="color: #000000;">top:20px;
</span><span style="color: #008080;">41</span> <span style="color: #000000;">}
</span><span style="color: #008080;">42</span>  
<span style="color: #008080;">43</span> <span style="color: #000000;">div.workingroom div.addOrEdit{
</span><span style="color: #008080;">44</span> <span style="color: #000000;">    margin:20px;
</span><span style="color: #008080;">45</span>     text-<span style="color: #000000;">align:center;
</span><span style="color: #008080;">46</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>listUser.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('ece9db1c-b383-4785-9d89-befcadf0fea7')"><img id="code_img_closed_ece9db1c-b383-4785-9d89-befcadf0fea7" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_ece9db1c-b383-4785-9d89-befcadf0fea7" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('ece9db1c-b383-4785-9d89-befcadf0fea7',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_ece9db1c-b383-4785-9d89-befcadf0fea7" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span> &lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
<span style="color: #008080;"> 9</span>  
<span style="color: #008080;">10</span> &lt;link rel="stylesheet" type="text/css" href="../static/css/style.css" /&gt;
<span style="color: #008080;">11</span> &lt;/head&gt;
<span style="color: #008080;">12</span> &lt;body&gt;
<span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">15</span>     &lt;%@include file="include/menu.jsp" %&gt;
<span style="color: #008080;">16</span>     &lt;table&gt;
<span style="color: #008080;">17</span>         &lt;tr&gt;
<span style="color: #008080;">18</span>             &lt;td&gt;id&lt;/td&gt;
<span style="color: #008080;">19</span>             &lt;td&gt;用户名称&lt;/td&gt;
<span style="color: #008080;">20</span>             &lt;td&gt;用户密码&lt;/td&gt;
<span style="color: #008080;">21</span>             &lt;td&gt;加密盐&lt;/td&gt;
<span style="color: #008080;">22</span>             &lt;td&gt;角色&lt;/td&gt;
<span style="color: #008080;">23</span>             &lt;td&gt;编辑&lt;/td&gt;
<span style="color: #008080;">24</span>             &lt;td&gt;删除&lt;/td&gt;
<span style="color: #008080;">25</span>         &lt;/tr&gt;
<span style="color: #008080;">26</span>         &lt;c:forEach items="${us}" var="u"&gt;
<span style="color: #008080;">27</span>             &lt;tr&gt;
<span style="color: #008080;">28</span>                 &lt;td&gt;${u.id}&lt;/td&gt;
<span style="color: #008080;">29</span>                 &lt;td&gt;${u.name}&lt;/td&gt;
<span style="color: #008080;">30</span>                 &lt;td&gt;${fn:substring(u.password, 0, 5)}...&lt;/td&gt;
<span style="color: #008080;">31</span>                 &lt;td&gt;${fn:substring(u.salt, 0, 5)}...&lt;/td&gt;
<span style="color: #008080;">32</span>                 &lt;td&gt;
<span style="color: #008080;">33</span>                      &lt;c:forEach items="${user_roles[u]}" var="r"&gt;
<span style="color: #008080;">34</span>                         ${r.name} &lt;br&gt;
<span style="color: #008080;">35</span>                      &lt;/c:forEach&gt;
<span style="color: #008080;">36</span>                 &lt;/td&gt;
<span style="color: #008080;">37</span>                 &lt;td&gt;&lt;a href="editUser?id=${u.id}"&gt;编辑&lt;/a&gt;&lt;/td&gt;
<span style="color: #008080;">38</span>                 &lt;td&gt;&lt;a href="deleteUser?id=${u.id}"&gt;删除&lt;/a&gt;&lt;/td&gt;
<span style="color: #008080;">39</span>             &lt;/tr&gt;
<span style="color: #008080;">40</span>         &lt;/c:forEach&gt;
<span style="color: #008080;">41</span>     &lt;/table&gt;
<span style="color: #008080;">42</span>      
<span style="color: #008080;">43</span>     &lt;div <span style="color: #0000ff;">class</span>="addOrEdit" &gt;
<span style="color: #008080;">44</span>         &lt;form action="addUser" method="post"&gt;
<span style="color: #008080;">45</span>             用户名: &lt;input type="text" name="name"&gt; &lt;br&gt;
<span style="color: #008080;">46</span>             密码: &lt;input type="password" name="password"&gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">47</span>             &lt;input type="submit" value="增加"&gt;
<span style="color: #008080;">48</span>         &lt;/form&gt;  
<span style="color: #008080;">49</span>     &lt;/div&gt;
<span style="color: #008080;">50</span> &lt;/div&gt;
<span style="color: #008080;">51</span> &lt;/body&gt;
<span style="color: #008080;">52</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>editUser.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('bc576d78-bc5b-49e4-a2f9-6191bf36cc48')"><img id="code_img_closed_bc576d78-bc5b-49e4-a2f9-6191bf36cc48" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_bc576d78-bc5b-49e4-a2f9-6191bf36cc48" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bc576d78-bc5b-49e4-a2f9-6191bf36cc48',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_bc576d78-bc5b-49e4-a2f9-6191bf36cc48" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> &lt;link rel="stylesheet" type="text/css" href="../static/css/style.css" /&gt;
<span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> &lt;/head&gt;
<span style="color: #008080;">12</span> &lt;body&gt;
<span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">15</span>      
<span style="color: #008080;">16</span>     &lt;%@include file="include/menu.jsp" %&gt;
<span style="color: #008080;">17</span>  
<span style="color: #008080;">18</span>     &lt;div <span style="color: #0000ff;">class</span>="addOrEdit" &gt;
<span style="color: #008080;">19</span>         &lt;form action="updateUser" method="post"&gt;
<span style="color: #008080;">20</span>             用户名: &lt;input type="text" name="name" value="${user.name}"&gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">21</span>             密码: &lt;input type="password" name="password" value="" placeholder="留空就表示不修改密码"&gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">22</span>             配置角色:&lt;br&gt;
<span style="color: #008080;">23</span>             &lt;div style="text-align:left;width:300px;margin:0px auto;padding-left:50px"&gt;
<span style="color: #008080;">24</span>                 &lt;c:forEach items="${rs}" var="r"&gt;
<span style="color: #008080;">25</span>                     &lt;c:set var="hasRole" value="false" /&gt;
<span style="color: #008080;">26</span>                     &lt;c:forEach items="${currentRoles}" var="currentRole"&gt;
<span style="color: #008080;">27</span>                         &lt;c:<span style="color: #0000ff;">if</span> test="${r.id==currentRole.id}"&gt;
<span style="color: #008080;">28</span>                             &lt;c:set var="hasRole" value="true" /&gt;
<span style="color: #008080;">29</span>                         &lt;/c:<span style="color: #0000ff;">if</span>&gt;
<span style="color: #008080;">30</span>                     &lt;/c:forEach&gt;
<span style="color: #008080;">31</span>                     &lt;input type="checkbox"  ${hasRole?"checked='checked'":"" } name="roleIds" value="${r.id}"&gt; ${r.name}&lt;br&gt;
<span style="color: #008080;">32</span>                 &lt;/c:forEach&gt;
<span style="color: #008080;">33</span>             &lt;/div&gt;
<span style="color: #008080;">34</span>              
<span style="color: #008080;">35</span>             &lt;br&gt;
<span style="color: #008080;">36</span>             &lt;input type="hidden" name="id" value="${user.id}"&gt;
<span style="color: #008080;">37</span>             &lt;input type="submit" value="修改"&gt;
<span style="color: #008080;">38</span>         &lt;/form&gt;  
<span style="color: #008080;">39</span>     &lt;/div&gt;
<span style="color: #008080;">40</span> &lt;/div&gt;
<span style="color: #008080;">41</span> &lt;script&gt;
<span style="color: #008080;">42</span> &lt;/script&gt;
<span style="color: #008080;">43</span> &lt;/body&gt;
<span style="color: #008080;">44</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>listRole.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('da0222b9-45ca-459c-a8ee-718b3f9b068d')"><img id="code_img_closed_da0222b9-45ca-459c-a8ee-718b3f9b068d" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_da0222b9-45ca-459c-a8ee-718b3f9b068d" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('da0222b9-45ca-459c-a8ee-718b3f9b068d',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_da0222b9-45ca-459c-a8ee-718b3f9b068d" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> &lt;link rel="stylesheet" type="text/css" href="../static/css/style.css" /&gt;
<span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> &lt;/head&gt;
<span style="color: #008080;">12</span> &lt;body&gt;
<span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">15</span>      
<span style="color: #008080;">16</span>     &lt;%@include file="include/menu.jsp" %&gt;
<span style="color: #008080;">17</span>      
<span style="color: #008080;">18</span>     &lt;table&gt;
<span style="color: #008080;">19</span>         &lt;tr&gt;
<span style="color: #008080;">20</span>             &lt;td&gt;id&lt;/td&gt;
<span style="color: #008080;">21</span>             &lt;td&gt;角色名称&lt;/td&gt;
<span style="color: #008080;">22</span>             &lt;td&gt;角色描述&lt;/td&gt;
<span style="color: #008080;">23</span>             &lt;td&gt;权限&lt;/td&gt;
<span style="color: #008080;">24</span>             &lt;td&gt;编辑&lt;/td&gt;
<span style="color: #008080;">25</span>             &lt;td&gt;删除&lt;/td&gt;
<span style="color: #008080;">26</span>         &lt;/tr&gt;
<span style="color: #008080;">27</span>         &lt;c:forEach items="${rs}" var="r"&gt;
<span style="color: #008080;">28</span>             &lt;tr&gt;
<span style="color: #008080;">29</span>                 &lt;td&gt;${r.id}&lt;/td&gt;
<span style="color: #008080;">30</span>                 &lt;td&gt;${r.name}&lt;/td&gt;
<span style="color: #008080;">31</span>                 &lt;td&gt;${r.desc_}&lt;/td&gt;
<span style="color: #008080;">32</span>                 &lt;td&gt;
<span style="color: #008080;">33</span>                      &lt;c:forEach items="${role_permissions[r]}" var="p"&gt;
<span style="color: #008080;">34</span>                         ${p.name} &lt;br&gt;
<span style="color: #008080;">35</span>                      &lt;/c:forEach&gt;
<span style="color: #008080;">36</span>                 &lt;/td&gt;
<span style="color: #008080;">37</span>                  
<span style="color: #008080;">38</span>                 &lt;td&gt;&lt;a href="editRole?id=${r.id}"&gt;编辑&lt;/a&gt;&lt;/td&gt;
<span style="color: #008080;">39</span>                 &lt;td&gt;&lt;a href="deleteRole?id=${r.id}"&gt;删除&lt;/a&gt;&lt;/td&gt;
<span style="color: #008080;">40</span>             &lt;/tr&gt;
<span style="color: #008080;">41</span>         &lt;/c:forEach&gt;
<span style="color: #008080;">42</span>     &lt;/table&gt;
<span style="color: #008080;">43</span>      
<span style="color: #008080;">44</span>     &lt;div <span style="color: #0000ff;">class</span>="addOrEdit" &gt;
<span style="color: #008080;">45</span>         &lt;form action="addRole" method="post"&gt;
<span style="color: #008080;">46</span>             角色名称: &lt;input type="text" name="name"&gt; &lt;br&gt;
<span style="color: #008080;">47</span>             角色描述: &lt;input type="text" name="desc_"&gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">48</span>             &lt;input type="submit" value="增加"&gt;
<span style="color: #008080;">49</span>         &lt;/form&gt;  
<span style="color: #008080;">50</span>     &lt;/div&gt;
<span style="color: #008080;">51</span> &lt;/div&gt;
<span style="color: #008080;">52</span> &lt;/body&gt;
<span style="color: #008080;">53</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>editRole.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('713cfc06-682e-4784-9edd-cf616c6bba8f')"><img id="code_img_closed_713cfc06-682e-4784-9edd-cf616c6bba8f" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_713cfc06-682e-4784-9edd-cf616c6bba8f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('713cfc06-682e-4784-9edd-cf616c6bba8f',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_713cfc06-682e-4784-9edd-cf616c6bba8f" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> &lt;link rel="stylesheet" type="text/css" href="../static/css/style.css" /&gt;
<span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> &lt;/head&gt;
<span style="color: #008080;">12</span> &lt;body&gt;
<span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">15</span>      
<span style="color: #008080;">16</span>     &lt;%@include file="include/menu.jsp" %&gt;
<span style="color: #008080;">17</span>  
<span style="color: #008080;">18</span>     &lt;div <span style="color: #0000ff;">class</span>="addOrEdit" &gt;
<span style="color: #008080;">19</span>         &lt;form action="updateRole" method="post"&gt;
<span style="color: #008080;">20</span>             角色名: &lt;input type="text" name="name" value="${role.name}"&gt; &lt;br&gt;
<span style="color: #008080;">21</span>             角色描述: &lt;input type="text" name="desc_" value="${role.desc_}" &gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">22</span>             配置权限:&lt;br&gt;
<span style="color: #008080;">23</span>             &lt;div style="text-align:left;width:300px;margin:0px auto;padding-left:50px"&gt;
<span style="color: #008080;">24</span>                 &lt;c:forEach items="${ps}" var="p"&gt;
<span style="color: #008080;">25</span>                     &lt;c:set var="hasPermission" value="false" /&gt;
<span style="color: #008080;">26</span>                     &lt;c:forEach items="${currentPermissions}" var="currentPermission"&gt;
<span style="color: #008080;">27</span>                         &lt;c:<span style="color: #0000ff;">if</span> test="${p.id==currentPermission.id}"&gt;
<span style="color: #008080;">28</span>                             &lt;c:set var="hasPermission" value="true" /&gt;
<span style="color: #008080;">29</span>                         &lt;/c:<span style="color: #0000ff;">if</span>&gt;
<span style="color: #008080;">30</span>                     &lt;/c:forEach&gt;
<span style="color: #008080;">31</span>                     &lt;input type="checkbox"  ${hasPermission?"checked='checked'":"" } name="permissionIds" value="${p.id}"&gt; ${p.name}&lt;br&gt;
<span style="color: #008080;">32</span>                 &lt;/c:forEach&gt;
<span style="color: #008080;">33</span>             &lt;/div&gt;           
<span style="color: #008080;">34</span>              
<span style="color: #008080;">35</span>             &lt;input type="hidden" name="id" value="${role.id}"&gt;
<span style="color: #008080;">36</span>             &lt;input type="submit" value="修改"&gt;
<span style="color: #008080;">37</span>         &lt;/form&gt;  
<span style="color: #008080;">38</span>     &lt;/div&gt;
<span style="color: #008080;">39</span> &lt;/div&gt;
<span style="color: #008080;">40</span> &lt;/body&gt;
<span style="color: #008080;">41</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>listPermission.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0a060b33-f35c-4091-ae80-8d10bb38dd31')"><img id="code_img_closed_0a060b33-f35c-4091-ae80-8d10bb38dd31" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_0a060b33-f35c-4091-ae80-8d10bb38dd31" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0a060b33-f35c-4091-ae80-8d10bb38dd31',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_0a060b33-f35c-4091-ae80-8d10bb38dd31" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> &lt;link rel="stylesheet" type="text/css" href="../static/css/style.css" /&gt;
<span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> &lt;/head&gt;
<span style="color: #008080;">12</span> &lt;body&gt;
<span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">15</span>      
<span style="color: #008080;">16</span>     &lt;%@include file="include/menu.jsp" %&gt;
<span style="color: #008080;">17</span>      
<span style="color: #008080;">18</span>     &lt;table&gt;
<span style="color: #008080;">19</span>         &lt;tr&gt;
<span style="color: #008080;">20</span>             &lt;td&gt;id&lt;/td&gt;
<span style="color: #008080;">21</span>             &lt;td&gt;权限名称&lt;/td&gt;
<span style="color: #008080;">22</span>             &lt;td&gt;权限描述&lt;/td&gt;
<span style="color: #008080;">23</span>             &lt;td&gt;权限对应的路径&lt;/td&gt;
<span style="color: #008080;">24</span>             &lt;td&gt;编辑&lt;/td&gt;
<span style="color: #008080;">25</span>             &lt;td&gt;删除&lt;/td&gt;
<span style="color: #008080;">26</span>         &lt;/tr&gt;
<span style="color: #008080;">27</span>         &lt;c:forEach items="${ps}" var="p"&gt;
<span style="color: #008080;">28</span>             &lt;tr&gt;
<span style="color: #008080;">29</span>                 &lt;td&gt;${p.id}&lt;/td&gt;
<span style="color: #008080;">30</span>                 &lt;td&gt;${p.name}&lt;/td&gt;
<span style="color: #008080;">31</span>                 &lt;td&gt;${p.desc_}&lt;/td&gt;
<span style="color: #008080;">32</span>                 &lt;td&gt;${p.url}&lt;/td&gt;
<span style="color: #008080;">33</span>                 &lt;td&gt;&lt;a href="editPermission?id=${p.id}"&gt;编辑&lt;/a&gt;&lt;/td&gt;
<span style="color: #008080;">34</span>                 &lt;td&gt;&lt;a href="deletePermission?id=${p.id}"&gt;删除&lt;/a&gt;&lt;/td&gt;
<span style="color: #008080;">35</span>             &lt;/tr&gt;
<span style="color: #008080;">36</span>         &lt;/c:forEach&gt;
<span style="color: #008080;">37</span>     &lt;/table&gt;
<span style="color: #008080;">38</span>      
<span style="color: #008080;">39</span>     &lt;div <span style="color: #0000ff;">class</span>="addOrEdit" &gt;
<span style="color: #008080;">40</span>         &lt;form action="addPermission" method="post"&gt;
<span style="color: #008080;">41</span>             权限名称: &lt;input type="text" name="name"&gt; &lt;br&gt;
<span style="color: #008080;">42</span>             权限描述: &lt;input type="text" name="desc_"&gt; &lt;br&gt;
<span style="color: #008080;">43</span>             权限对应的url: &lt;input type="text" name="url"&gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">44</span>             &lt;input type="submit" value="增加"&gt;
<span style="color: #008080;">45</span>         &lt;/form&gt;  
<span style="color: #008080;">46</span>     &lt;/div&gt;
<span style="color: #008080;">47</span> &lt;/div&gt;
<span style="color: #008080;">48</span> &lt;/body&gt;
<span style="color: #008080;">49</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>editPermission.jsp</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('cb3e131a-de21-4a89-b4a2-91542c162814')"><img id="code_img_closed_cb3e131a-de21-4a89-b4a2-91542c162814" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_cb3e131a-de21-4a89-b4a2-91542c162814" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('cb3e131a-de21-4a89-b4a2-91542c162814',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_cb3e131a-de21-4a89-b4a2-91542c162814" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;%@ page language="java" contentType="text/html; charset=UTF-8"
<span style="color: #008080;"> 2</span>     pageEncoding="UTF-8"%&gt;
<span style="color: #008080;"> 3</span> &lt;html&gt;
<span style="color: #008080;"> 4</span> &lt;head&gt;
<span style="color: #008080;"> 5</span> &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
<span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%&gt;
<span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> &lt;link rel="stylesheet" type="text/css" href="../static/css/style.css" /&gt;
<span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> &lt;/head&gt;
<span style="color: #008080;">12</span> &lt;body&gt;
<span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> &lt;div <span style="color: #0000ff;">class</span>="workingroom"&gt;
<span style="color: #008080;">15</span>      
<span style="color: #008080;">16</span>     &lt;%@include file="include/menu.jsp" %&gt;
<span style="color: #008080;">17</span>  
<span style="color: #008080;">18</span>     &lt;div <span style="color: #0000ff;">class</span>="addOrEdit" &gt;
<span style="color: #008080;">19</span>         &lt;form action="updatePermission" method="post"&gt;
<span style="color: #008080;">20</span>             权限名称: &lt;input type="text" name="name" value="${permission.name}"&gt; &lt;br&gt;
<span style="color: #008080;">21</span>             权限描述: &lt;input type="text" name="desc_" value="${permission.desc_}"&gt; &lt;br&gt;
<span style="color: #008080;">22</span>             权限对应的url: &lt;input type="text" name="url"  value="${permission.url}"&gt; &lt;br&gt;&lt;br&gt;
<span style="color: #008080;">23</span>             &lt;input type="hidden" name="id" value="${permission.id}"&gt;
<span style="color: #008080;">24</span>             &lt;input type="submit" value="修改"&gt;
<span style="color: #008080;">25</span>         &lt;/form&gt;  
<span style="color: #008080;">26</span>     &lt;/div&gt;
<span style="color: #008080;">27</span> &lt;/div&gt;
<span style="color: #008080;">28</span> &lt;/body&gt;
<span style="color: #008080;">29</span> &lt;/html&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>OverIsMergeablePlugin.java</h2>
<p><span style="font-family: 宋体;">这个类的解释见，</span><a href="https://www.cnblogs.com/kaspar/p/11642459.html" target="_blank"><strong><span style="font-family: 宋体;">解决</span>MybatisGenerator<span style="font-family: 宋体;">多次运行</span><span style="font-family: Helvetica;">mapper</span><span style="font-family: 宋体;">生成重复内容</span></strong></a><span style="font-family: 宋体;">。</span></p>
<p><strong>代码如下：</strong></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('baf55aca-0436-47eb-9365-44f67eba5901')"><img id="code_img_closed_baf55aca-0436-47eb-9365-44f67eba5901" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_baf55aca-0436-47eb-9365-44f67eba5901" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('baf55aca-0436-47eb-9365-44f67eba5901',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_baf55aca-0436-47eb-9365-44f67eba5901" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.util;
</span><span style="color: #008080;"> 2</span>   
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.api.GeneratedXmlFile;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.api.IntrospectedTable;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.api.PluginAdapter;
</span><span style="color: #008080;"> 7</span>   
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.lang.reflect.Field;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;">10</span>   
<span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> OverIsMergeablePlugin <span style="color: #0000ff;">extends</span><span style="color: #000000;"> PluginAdapter {
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span> validate(List&lt;String&gt;<span style="color: #000000;"> warnings) {
</span><span style="color: #008080;">14</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">16</span>   
<span style="color: #008080;">17</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">boolean</span><span style="color: #000000;"> sqlMapGenerated(GeneratedXmlFile sqlMap, IntrospectedTable introspectedTable) {
</span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">20</span>             Field field = sqlMap.getClass().getDeclaredField("isMergeable"<span style="color: #000000;">);
</span><span style="color: #008080;">21</span>             field.setAccessible(<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;">22</span>             field.setBoolean(sqlMap, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">23</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">24</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">25</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">28</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>generatorConfig.xml</h2>
<p><span style="font-family: 宋体;">目录如下：</span></p>
<p><span style="font-family: 宋体;"><img src="./images/Shiro集成SSM基于URL权限管理(一)47.png" alt="" /></span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('562ad0ce-440d-471a-9345-c4bd04e829b9')"><img id="code_img_closed_562ad0ce-440d-471a-9345-c4bd04e829b9" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_562ad0ce-440d-471a-9345-c4bd04e829b9" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('562ad0ce-440d-471a-9345-c4bd04e829b9',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_562ad0ce-440d-471a-9345-c4bd04e829b9" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span style="color: #008080;"> 2</span> &lt;!<span style="color: #000000;">DOCTYPE generatorConfiguration
</span><span style="color: #008080;"> 3</span>         PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"
<span style="color: #008080;"> 4</span>         "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;
<span style="color: #008080;"> 5</span> &lt;generatorConfiguration&gt;
<span style="color: #008080;"> 6</span>   
<span style="color: #008080;"> 7</span>     &lt;context id="DB2Tables"    targetRuntime="MyBatis3"&gt;
<span style="color: #008080;"> 8</span>         &lt;!--避免生成重复代码的插件--&gt;
<span style="color: #008080;"> 9</span>         &lt;plugin type="com.how2java.util.OverIsMergeablePlugin" /&gt;
<span style="color: #008080;">10</span>   
<span style="color: #008080;">11</span>         &lt;!--是否在代码中显示注释--&gt;
<span style="color: #008080;">12</span>         &lt;commentGenerator&gt;
<span style="color: #008080;">13</span>             &lt;property name="suppressDate" value="true" /&gt;
<span style="color: #008080;">14</span>             &lt;property name="suppressAllComments" value="true" /&gt;
<span style="color: #008080;">15</span>         &lt;/commentGenerator&gt;
<span style="color: #008080;">16</span>   
<span style="color: #008080;">17</span>         &lt;!--数据库链接地址账号密码--&gt;
<span style="color: #008080;">18</span>         &lt;jdbcConnection driverClass="com.mysql.jdbc.Driver" connectionURL="jdbc:mysql://localhost/shiro" userId="root" password="admin"&gt;
<span style="color: #008080;">19</span>         &lt;/jdbcConnection&gt;
<span style="color: #008080;">20</span>         &lt;!--不知道做什么用的。。。反正贴上来了~--&gt;
<span style="color: #008080;">21</span>         &lt;javaTypeResolver&gt;
<span style="color: #008080;">22</span>             &lt;property name="forceBigDecimals" value="false"/&gt;
<span style="color: #008080;">23</span>         &lt;/javaTypeResolver&gt;
<span style="color: #008080;">24</span>         &lt;!--生成pojo类存放位置--&gt;
<span style="color: #008080;">25</span>         &lt;javaModelGenerator targetPackage="com.how2java.pojo" targetProject="src"&gt;
<span style="color: #008080;">26</span>             &lt;property name="enableSubPackages" value="true"/&gt;
<span style="color: #008080;">27</span>             &lt;property name="trimStrings" value="true"/&gt;
<span style="color: #008080;">28</span>         &lt;/javaModelGenerator&gt;
<span style="color: #008080;">29</span>         &lt;!--生成xml映射文件存放位置--&gt;
<span style="color: #008080;">30</span>         &lt;sqlMapGenerator targetPackage="com.how2java.mapper" targetProject="src"&gt;
<span style="color: #008080;">31</span>             &lt;property name="enableSubPackages" value="true"/&gt;
<span style="color: #008080;">32</span>         &lt;/sqlMapGenerator&gt;
<span style="color: #008080;">33</span>         &lt;!--生成mapper类存放位置--&gt;
<span style="color: #008080;">34</span>         &lt;javaClientGenerator type="XMLMAPPER" targetPackage="com.how2java.mapper" targetProject="src"&gt;
<span style="color: #008080;">35</span>             &lt;property name="enableSubPackages" value="true"/&gt;
<span style="color: #008080;">36</span>         &lt;/javaClientGenerator&gt;
<span style="color: #008080;">37</span>   
<span style="color: #008080;">38</span>         &lt;!--生成对应表及类名--&gt;
<span style="color: #008080;">39</span>         &lt;table tableName="user" domainObjectName="User" enableCountByExample="false" enableUpdateByExample="false" enableDeleteByExample="false" enableSelectByExample="true" selectByExampleQueryId="false"&gt;
<span style="color: #008080;">40</span>             &lt;property name="my.isgen.usekeys" value="true"/&gt;
<span style="color: #008080;">41</span>             &lt;property name="useActualColumnNames" value="true"/&gt;
<span style="color: #008080;">42</span>             &lt;generatedKey column="id" sqlStatement="JDBC"/&gt;
<span style="color: #008080;">43</span>         &lt;/table&gt;
<span style="color: #008080;">44</span>         &lt;table tableName="role" domainObjectName="Role" enableCountByExample="false" enableUpdateByExample="false" enableDeleteByExample="false" enableSelectByExample="true" selectByExampleQueryId="false"&gt;
<span style="color: #008080;">45</span>             &lt;property name="my.isgen.usekeys" value="true"/&gt;
<span style="color: #008080;">46</span>             &lt;property name="useActualColumnNames" value="true"/&gt;
<span style="color: #008080;">47</span>             &lt;generatedKey column="id" sqlStatement="JDBC"/&gt;
<span style="color: #008080;">48</span>         &lt;/table&gt;
<span style="color: #008080;">49</span>         &lt;table tableName="permission" domainObjectName="Permission" enableCountByExample="false" enableUpdateByExample="false" enableDeleteByExample="false" enableSelectByExample="true" selectByExampleQueryId="false"&gt;
<span style="color: #008080;">50</span>             &lt;property name="my.isgen.usekeys" value="true"/&gt;
<span style="color: #008080;">51</span>             &lt;property name="useActualColumnNames" value="true"/&gt;
<span style="color: #008080;">52</span>             &lt;generatedKey column="id" sqlStatement="JDBC"/&gt;
<span style="color: #008080;">53</span>         &lt;/table&gt;
<span style="color: #008080;">54</span>         &lt;table tableName="user_role" domainObjectName="UserRole" enableCountByExample="false" enableUpdateByExample="false" enableDeleteByExample="false" enableSelectByExample="true" selectByExampleQueryId="false"&gt;
<span style="color: #008080;">55</span>             &lt;property name="my.isgen.usekeys" value="true"/&gt;
<span style="color: #008080;">56</span>             &lt;property name="useActualColumnNames" value="true"/&gt;
<span style="color: #008080;">57</span>             &lt;generatedKey column="id" sqlStatement="JDBC"/&gt;
<span style="color: #008080;">58</span>         &lt;/table&gt;
<span style="color: #008080;">59</span>         &lt;table tableName="role_permission" domainObjectName="RolePermission" enableCountByExample="false" enableUpdateByExample="false" enableDeleteByExample="false" enableSelectByExample="true" selectByExampleQueryId="false"&gt;
<span style="color: #008080;">60</span>             &lt;property name="my.isgen.usekeys" value="true"/&gt;
<span style="color: #008080;">61</span>             &lt;property name="useActualColumnNames" value="true"/&gt;
<span style="color: #008080;">62</span>             &lt;generatedKey column="id" sqlStatement="JDBC"/&gt;
<span style="color: #008080;">63</span>         &lt;/table&gt;
<span style="color: #008080;">64</span>  
<span style="color: #008080;">65</span>     &lt;/context&gt;
<span style="color: #008080;">66</span> &lt;/generatorConfiguration&gt;</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>MybatisGenerator.java</h2>
<p><span style="font-family: 宋体;">代码如下：</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('6927c6d3-ab67-47d0-aefa-717662cef5d6')"><img id="code_img_closed_6927c6d3-ab67-47d0-aefa-717662cef5d6" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_6927c6d3-ab67-47d0-aefa-717662cef5d6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('6927c6d3-ab67-47d0-aefa-717662cef5d6',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_6927c6d3-ab67-47d0-aefa-717662cef5d6" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.util;
</span><span style="color: #008080;"> 2</span>   
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.api.MyBatisGenerator;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.config.Configuration;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.config.xml.ConfigurationParser;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.mybatis.generator.internal.DefaultShellCallback;
</span><span style="color: #008080;"> 7</span>   
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.text.SimpleDateFormat;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Date;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;">13</span>   
<span style="color: #008080;">14</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> MybatisGenerator {
</span><span style="color: #008080;">15</span>   
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> main(String[] args) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> Exception {
</span><span style="color: #008080;">17</span>         String today = "2018-5-21"<span style="color: #000000;">;
</span><span style="color: #008080;">18</span>   
<span style="color: #008080;">19</span>         SimpleDateFormat sdf =<span style="color: #0000ff;">new</span> SimpleDateFormat("yyyy-MM-dd"<span style="color: #000000;">);
</span><span style="color: #008080;">20</span>         Date now =<span style="color: #000000;">sdf.parse(today);
</span><span style="color: #008080;">21</span>         Date d = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Date();
</span><span style="color: #008080;">22</span>   
<span style="color: #008080;">23</span>         <span style="color: #0000ff;">if</span>(d.getTime()&gt;now.getTime()+1000*60*60*24<span style="color: #000000;">){
</span><span style="color: #008080;">24</span>             System.err.println("&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;未成成功运行&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;"<span style="color: #000000;">);
</span><span style="color: #008080;">25</span>             System.err.println("&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;未成成功运行&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;"<span style="color: #000000;">);
</span><span style="color: #008080;">26</span>             System.err.println("本程序具有破坏作用，应该只运行一次，如果必须要再运行，需要修改today变量为今天，如:" + sdf.format(<span style="color: #0000ff;">new</span><span style="color: #000000;"> Date()));
</span><span style="color: #008080;">27</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">29</span>   
<span style="color: #008080;">30</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">false</span><span style="color: #000000;">)
</span><span style="color: #008080;">31</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">32</span>         List&lt;String&gt; warnings = <span style="color: #0000ff;">new</span> ArrayList&lt;String&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">boolean</span> overwrite = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">34</span>         InputStream is= MybatisGenerator.<span style="color: #0000ff;">class</span>.getClassLoader().getResource("generatorConfig.xml"<span style="color: #000000;">).openStream();
</span><span style="color: #008080;">35</span>         ConfigurationParser cp = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ConfigurationParser(warnings);
</span><span style="color: #008080;">36</span>         Configuration config =<span style="color: #000000;"> cp.parseConfiguration(is);
</span><span style="color: #008080;">37</span> <span style="color: #000000;">        is.close();
</span><span style="color: #008080;">38</span>         DefaultShellCallback callback = <span style="color: #0000ff;">new</span><span style="color: #000000;"> DefaultShellCallback(overwrite);
</span><span style="color: #008080;">39</span>         MyBatisGenerator myBatisGenerator = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MyBatisGenerator(config, callback, warnings);
</span><span style="color: #008080;">40</span>         myBatisGenerator.generate(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">41</span>   
<span style="color: #008080;">42</span>         System.out.println("生成代码成功，只能执行一次，以后执行会覆盖掉mapper,pojo,xml 等文件上做的修改"<span style="color: #000000;">);
</span><span style="color: #008080;">43</span>   
<span style="color: #008080;">44</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">45</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p><strong><span style="font-family: Helvetica;">运行</span> MybatisGenerator 以获取自动生成</strong><strong>&nbsp;</strong><strong>Pojo、Example 和 Mapper</strong></p>
<p>&nbsp;<img src="./images/Shiro集成SSM基于URL权限管理(一)52.png" alt="" /></p>
<p><strong>记得刷新一下项目。</strong></p>
<h2>Service层</h2>
<p>&nbsp;PermissionService</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('1f3b9d95-dac8-4d6b-8b7b-bae0bbe0ad03')"><img id="code_img_closed_1f3b9d95-dac8-4d6b-8b7b-bae0bbe0ad03" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_1f3b9d95-dac8-4d6b-8b7b-bae0bbe0ad03" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('1f3b9d95-dac8-4d6b-8b7b-bae0bbe0ad03',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_1f3b9d95-dac8-4d6b-8b7b-bae0bbe0ad03" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;
</span><span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Permission;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> PermissionService {
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> Set&lt;String&gt;<span style="color: #000000;"> listPermissions(String userName);
</span><span style="color: #008080;">11</span>  
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span> List&lt;Permission&gt;<span style="color: #000000;"> list();
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(Permission permission);
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> delete(Long id);
</span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Permission get(Long id);
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> update(Permission permission);
</span><span style="color: #008080;">17</span>  
<span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span> List&lt;Permission&gt;<span style="color: #000000;"> list(Role role);
</span><span style="color: #008080;">19</span>      
<span style="color: #008080;">20</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>RolePermissionService</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0468b6d3-dc12-4ca5-95fb-71985aaff6c3')"><img id="code_img_closed_0468b6d3-dc12-4ca5-95fb-71985aaff6c3" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_0468b6d3-dc12-4ca5-95fb-71985aaff6c3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0468b6d3-dc12-4ca5-95fb-71985aaff6c3',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_0468b6d3-dc12-4ca5-95fb-71985aaff6c3" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service;
</span><span style="color: #008080;">2</span>  
<span style="color: #008080;">3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">4</span>  
<span style="color: #008080;">5</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> RolePermissionService {
</span><span style="color: #008080;">6</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setPermissions(Role role, <span style="color: #0000ff;">long</span><span style="color: #000000;">[] permissionIds);
</span><span style="color: #008080;">7</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByRole(<span style="color: #0000ff;">long</span><span style="color: #000000;"> roleId);
</span><span style="color: #008080;">8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByPermission(<span style="color: #0000ff;">long</span><span style="color: #000000;"> permissionId);
</span><span style="color: #008080;">9</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>RoleService</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('c75f94ba-f94a-4559-9978-362706b89233')"><img id="code_img_closed_c75f94ba-f94a-4559-9978-362706b89233" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_c75f94ba-f94a-4559-9978-362706b89233" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('c75f94ba-f94a-4559-9978-362706b89233',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_c75f94ba-f94a-4559-9978-362706b89233" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;
</span><span style="color: #008080;"> 5</span>  
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;"> 8</span>  
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> RoleService {
</span><span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> Set&lt;String&gt;<span style="color: #000000;"> listRoleNames(String userName);
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">public</span> List&lt;Role&gt;<span style="color: #000000;"> listRoles(String userName);
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">public</span> List&lt;Role&gt;<span style="color: #000000;"> listRoles(User user);
</span><span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">public</span> List&lt;Role&gt;<span style="color: #000000;"> list();
</span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(Role role);
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> delete(Long id);
</span><span style="color: #008080;">17</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Role get(Long id);
</span><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> update(Role role);
</span><span style="color: #008080;">19</span>      
<span style="color: #008080;">20</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>UserRoleService</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('d21d0213-98ba-483e-a703-a0f658cc902e')"><img id="code_img_closed_d21d0213-98ba-483e-a703-a0f658cc902e" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_d21d0213-98ba-483e-a703-a0f658cc902e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('d21d0213-98ba-483e-a703-a0f658cc902e',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_d21d0213-98ba-483e-a703-a0f658cc902e" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> UserRoleService {
</span><span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setRoles(User user, <span style="color: #0000ff;">long</span><span style="color: #000000;">[] roleIds);
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByUser(<span style="color: #0000ff;">long</span><span style="color: #000000;"> userId);
</span><span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByRole(<span style="color: #0000ff;">long</span><span style="color: #000000;"> roleId);
</span><span style="color: #008080;">10</span>      
<span style="color: #008080;">11</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>UserService</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('8e4bf0af-a652-4f5f-991d-a135d68fe76b')"><img id="code_img_closed_8e4bf0af-a652-4f5f-991d-a135d68fe76b" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_8e4bf0af-a652-4f5f-991d-a135d68fe76b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('8e4bf0af-a652-4f5f-991d-a135d68fe76b',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_8e4bf0af-a652-4f5f-991d-a135d68fe76b" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service;
 
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> UserService {
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> String getPassword(String name);
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User getByName(String name);
     
    </span><span style="color: #0000ff;">public</span> List&lt;User&gt;<span style="color: #000000;"> list();
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(User user);
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> delete(Long id);
    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> User get(Long id);
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> update(User user);
}</span></code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>Service实现层</h2>
<p>PermissionServiceImpl</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0028d81e-970c-4ff7-b031-c659410a5115')"><img id="code_img_closed_0028d81e-970c-4ff7-b031-c659410a5115" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_0028d81e-970c-4ff7-b031-c659410a5115" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0028d81e-970c-4ff7-b031-c659410a5115',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_0028d81e-970c-4ff7-b031-c659410a5115" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service.impl;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashSet;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;
</span><span style="color: #008080;"> 7</span>  
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Service;
</span><span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.PermissionMapper;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.RolePermissionMapper;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Permission;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.PermissionExample;
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.RolePermission;
</span><span style="color: #008080;">17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.RolePermissionExample;
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.PermissionService;
</span><span style="color: #008080;">19</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RoleService;
</span><span style="color: #008080;">20</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserService;
</span><span style="color: #008080;">21</span>  
<span style="color: #008080;">22</span> <span style="color: #000000;">@Service
</span><span style="color: #008080;">23</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> PermissionServiceImpl  <span style="color: #0000ff;">implements</span><span style="color: #000000;"> PermissionService{
</span><span style="color: #008080;">24</span>  
<span style="color: #008080;">25</span> <span style="color: #000000;">    @Autowired PermissionMapper permissionMapper;
</span><span style="color: #008080;">26</span> <span style="color: #000000;">    @Autowired UserService userService;
</span><span style="color: #008080;">27</span> <span style="color: #000000;">    @Autowired RoleService roleService;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">    @Autowired RolePermissionMapper rolePermissionMapper;
</span><span style="color: #008080;">29</span>  
<span style="color: #008080;">30</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span> Set&lt;String&gt;<span style="color: #000000;"> listPermissions(String userName) {
</span><span style="color: #008080;">32</span>         Set&lt;String&gt; result = <span style="color: #0000ff;">new</span> HashSet&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">33</span>         List&lt;Role&gt; roles =<span style="color: #000000;"> roleService.listRoles(userName);
</span><span style="color: #008080;">34</span>          
<span style="color: #008080;">35</span>         List&lt;RolePermission&gt; rolePermissions = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">36</span>          
<span style="color: #008080;">37</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Role role : roles) {
</span><span style="color: #008080;">38</span>             RolePermissionExample example = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RolePermissionExample();
</span><span style="color: #008080;">39</span> <span style="color: #000000;">            example.createCriteria().andRidEqualTo(role.getId());
</span><span style="color: #008080;">40</span>             List&lt;RolePermission&gt; rps=<span style="color: #000000;"> rolePermissionMapper.selectByExample(example);
</span><span style="color: #008080;">41</span> <span style="color: #000000;">            rolePermissions.addAll(rps);
</span><span style="color: #008080;">42</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">43</span>          
<span style="color: #008080;">44</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (RolePermission rolePermission : rolePermissions) {
</span><span style="color: #008080;">45</span>             Permission p =<span style="color: #000000;"> permissionMapper.selectByPrimaryKey(rolePermission.getPid());
</span><span style="color: #008080;">46</span> <span style="color: #000000;">            result.add(p.getName());
</span><span style="color: #008080;">47</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">48</span>          
<span style="color: #008080;">49</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">50</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">51</span> <span style="color: #000000;">   @Override
</span><span style="color: #008080;">52</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(Permission u) {
</span><span style="color: #008080;">53</span> <span style="color: #000000;">        permissionMapper.insert(u);
</span><span style="color: #008080;">54</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">55</span>   
<span style="color: #008080;">56</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">57</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> delete(Long id) {
</span><span style="color: #008080;">58</span> <span style="color: #000000;">        permissionMapper.deleteByPrimaryKey(id);
</span><span style="color: #008080;">59</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">60</span>   
<span style="color: #008080;">61</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">62</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> update(Permission u) {
</span><span style="color: #008080;">63</span> <span style="color: #000000;">        permissionMapper.updateByPrimaryKeySelective(u);
</span><span style="color: #008080;">64</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">65</span>   
<span style="color: #008080;">66</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">67</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Permission get(Long id) {
</span><span style="color: #008080;">68</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> permissionMapper.selectByPrimaryKey(id);
</span><span style="color: #008080;">69</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">70</span>   
<span style="color: #008080;">71</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">72</span>     <span style="color: #0000ff;">public</span> List&lt;Permission&gt;<span style="color: #000000;"> list(){
</span><span style="color: #008080;">73</span>         PermissionExample example =<span style="color: #0000ff;">new</span><span style="color: #000000;"> PermissionExample();
</span><span style="color: #008080;">74</span>         example.setOrderByClause("id desc"<span style="color: #000000;">);
</span><span style="color: #008080;">75</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> permissionMapper.selectByExample(example);
</span><span style="color: #008080;">76</span>   
<span style="color: #008080;">77</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">78</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">79</span>     <span style="color: #0000ff;">public</span> List&lt;Permission&gt;<span style="color: #000000;"> list(Role role) {
</span><span style="color: #008080;">80</span>         List&lt;Permission&gt; result = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">81</span>         RolePermissionExample example = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RolePermissionExample();
</span><span style="color: #008080;">82</span> <span style="color: #000000;">        example.createCriteria().andRidEqualTo(role.getId());
</span><span style="color: #008080;">83</span>         List&lt;RolePermission&gt; rps =<span style="color: #000000;"> rolePermissionMapper.selectByExample(example);
</span><span style="color: #008080;">84</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (RolePermission rolePermission : rps) {
</span><span style="color: #008080;">85</span> <span style="color: #000000;">            result.add(permissionMapper.selectByPrimaryKey(rolePermission.getPid()));
</span><span style="color: #008080;">86</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">87</span>          
<span style="color: #008080;">88</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">89</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">90</span>  
<span style="color: #008080;">91</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>RolePermissionServiceImpl</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('70add16e-559a-48fe-b922-cff7a04f3d7c')"><img id="code_img_closed_70add16e-559a-48fe-b922-cff7a04f3d7c" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_70add16e-559a-48fe-b922-cff7a04f3d7c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('70add16e-559a-48fe-b922-cff7a04f3d7c',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_70add16e-559a-48fe-b922-cff7a04f3d7c" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service.impl;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Service;
</span><span style="color: #008080;"> 7</span>  
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.RolePermissionMapper;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Permission;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.RolePermission;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.RolePermissionExample;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RolePermissionService;
</span><span style="color: #008080;">14</span>  
<span style="color: #008080;">15</span> <span style="color: #000000;">@Service
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> RolePermissionServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> RolePermissionService{
</span><span style="color: #008080;">17</span>  
<span style="color: #008080;">18</span> <span style="color: #000000;">    @Autowired RolePermissionMapper rolePermissionMapper;
</span><span style="color: #008080;">19</span>  
<span style="color: #008080;">20</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setPermissions(Role role, <span style="color: #0000ff;">long</span><span style="color: #000000;">[] permissionIds) {
</span><span style="color: #008080;">22</span>         <span style="color: #008000;">//</span><span style="color: #008000;">删除当前角色所有的权限</span>
<span style="color: #008080;">23</span>         RolePermissionExample example= <span style="color: #0000ff;">new</span><span style="color: #000000;"> RolePermissionExample();
</span><span style="color: #008080;">24</span> <span style="color: #000000;">        example.createCriteria().andRidEqualTo(role.getId());
</span><span style="color: #008080;">25</span>         List&lt;RolePermission&gt; rps=<span style="color: #000000;"> rolePermissionMapper.selectByExample(example);
</span><span style="color: #008080;">26</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (RolePermission rolePermission : rps)
</span><span style="color: #008080;">27</span> <span style="color: #000000;">            rolePermissionMapper.deleteByPrimaryKey(rolePermission.getId());
</span><span style="color: #008080;">28</span>  
<span style="color: #008080;">29</span>         <span style="color: #008000;">//</span><span style="color: #008000;">设置新的权限关系</span>
<span style="color: #008080;">30</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span>!=<span style="color: #000000;">permissionIds)
</span><span style="color: #008080;">31</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">long</span><span style="color: #000000;"> pid : permissionIds) {
</span><span style="color: #008080;">32</span>                 RolePermission rolePermission = <span style="color: #0000ff;">new</span><span style="color: #000000;"> RolePermission();
</span><span style="color: #008080;">33</span> <span style="color: #000000;">                rolePermission.setPid(pid);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">                rolePermission.setRid(role.getId());
</span><span style="color: #008080;">35</span> <span style="color: #000000;">                rolePermissionMapper.insert(rolePermission);
</span><span style="color: #008080;">36</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span>  
<span style="color: #008080;">39</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">40</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByRole(<span style="color: #0000ff;">long</span><span style="color: #000000;"> roleId) {
</span><span style="color: #008080;">41</span>         RolePermissionExample example= <span style="color: #0000ff;">new</span><span style="color: #000000;"> RolePermissionExample();
</span><span style="color: #008080;">42</span> <span style="color: #000000;">        example.createCriteria().andRidEqualTo(roleId);
</span><span style="color: #008080;">43</span>         List&lt;RolePermission&gt; rps=<span style="color: #000000;"> rolePermissionMapper.selectByExample(example);
</span><span style="color: #008080;">44</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (RolePermission rolePermission : rps)
</span><span style="color: #008080;">45</span> <span style="color: #000000;">            rolePermissionMapper.deleteByPrimaryKey(rolePermission.getId());
</span><span style="color: #008080;">46</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">47</span>  
<span style="color: #008080;">48</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">49</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByPermission(<span style="color: #0000ff;">long</span><span style="color: #000000;"> permissionId) {
</span><span style="color: #008080;">50</span>         RolePermissionExample example= <span style="color: #0000ff;">new</span><span style="color: #000000;"> RolePermissionExample();
</span><span style="color: #008080;">51</span> <span style="color: #000000;">        example.createCriteria().andPidEqualTo(permissionId);
</span><span style="color: #008080;">52</span>         List&lt;RolePermission&gt; rps=<span style="color: #000000;"> rolePermissionMapper.selectByExample(example);
</span><span style="color: #008080;">53</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (RolePermission rolePermission : rps)
</span><span style="color: #008080;">54</span> <span style="color: #000000;">            rolePermissionMapper.deleteByPrimaryKey(rolePermission.getId());
</span><span style="color: #008080;">55</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">56</span>  
<span style="color: #008080;">57</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>RoleServiceImpl</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('4cd65029-df9c-420a-be48-e0c0c576c4ab')"><img id="code_img_closed_4cd65029-df9c-420a-be48-e0c0c576c4ab" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_4cd65029-df9c-420a-be48-e0c0c576c4ab" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4cd65029-df9c-420a-be48-e0c0c576c4ab',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_4cd65029-df9c-420a-be48-e0c0c576c4ab" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service.impl;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.ArrayList;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashSet;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;
</span><span style="color: #008080;"> 7</span>  
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Service;
</span><span style="color: #008080;">10</span>  
<span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.RoleMapper;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.UserRoleMapper;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.RoleExample;
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.UserRole;
</span><span style="color: #008080;">17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.UserRoleExample;
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RoleService;
</span><span style="color: #008080;">19</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserService;
</span><span style="color: #008080;">20</span>  
<span style="color: #008080;">21</span> <span style="color: #000000;">@Service
</span><span style="color: #008080;">22</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> RoleServiceImpl  <span style="color: #0000ff;">implements</span><span style="color: #000000;"> RoleService{
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    @Autowired RoleMapper roleMapper;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    @Autowired UserRoleMapper userRoleMapper;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    @Autowired UserService userService;
</span><span style="color: #008080;">26</span>  
<span style="color: #008080;">27</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">public</span> Set&lt;String&gt;<span style="color: #000000;"> listRoleNames(String userName) {
</span><span style="color: #008080;">29</span>         Set&lt;String&gt; result = <span style="color: #0000ff;">new</span> HashSet&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">30</span>         List&lt;Role&gt; roles =<span style="color: #000000;"> listRoles(userName);
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Role role : roles) {
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            result.add(role.getName());
</span><span style="color: #008080;">33</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">34</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> result;
</span><span style="color: #008080;">35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">36</span>  
<span style="color: #008080;">37</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">38</span>     <span style="color: #0000ff;">public</span> List&lt;Role&gt;<span style="color: #000000;"> listRoles(String userName) {
</span><span style="color: #008080;">39</span>         List&lt;Role&gt; roles = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">40</span>         User user =<span style="color: #000000;"> userService.getByName(userName);
</span><span style="color: #008080;">41</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span>==<span style="color: #000000;">user)
</span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> roles;
</span><span style="color: #008080;">43</span>          
<span style="color: #008080;">44</span>         roles =<span style="color: #000000;"> listRoles(user);
</span><span style="color: #008080;">45</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> roles;
</span><span style="color: #008080;">46</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">47</span>      
<span style="color: #008080;">48</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">49</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(Role u) {
</span><span style="color: #008080;">50</span> <span style="color: #000000;">        roleMapper.insert(u);
</span><span style="color: #008080;">51</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">52</span>   
<span style="color: #008080;">53</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">54</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> delete(Long id) {
</span><span style="color: #008080;">55</span> <span style="color: #000000;">        roleMapper.deleteByPrimaryKey(id);
</span><span style="color: #008080;">56</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">57</span>   
<span style="color: #008080;">58</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">59</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> update(Role u) {
</span><span style="color: #008080;">60</span> <span style="color: #000000;">        roleMapper.updateByPrimaryKeySelective(u);
</span><span style="color: #008080;">61</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">62</span>   
<span style="color: #008080;">63</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">64</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Role get(Long id) {
</span><span style="color: #008080;">65</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> roleMapper.selectByPrimaryKey(id);
</span><span style="color: #008080;">66</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">67</span>   
<span style="color: #008080;">68</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">69</span>     <span style="color: #0000ff;">public</span> List&lt;Role&gt;<span style="color: #000000;"> list(){
</span><span style="color: #008080;">70</span>         RoleExample example =<span style="color: #0000ff;">new</span><span style="color: #000000;"> RoleExample();
</span><span style="color: #008080;">71</span>         example.setOrderByClause("id desc"<span style="color: #000000;">);
</span><span style="color: #008080;">72</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> roleMapper.selectByExample(example);
</span><span style="color: #008080;">73</span>   
<span style="color: #008080;">74</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">75</span>  
<span style="color: #008080;">76</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">77</span>     <span style="color: #0000ff;">public</span> List&lt;Role&gt;<span style="color: #000000;"> listRoles(User user) {
</span><span style="color: #008080;">78</span>         List&lt;Role&gt; roles = <span style="color: #0000ff;">new</span> ArrayList&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">79</span>  
<span style="color: #008080;">80</span>         UserRoleExample example = <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserRoleExample();
</span><span style="color: #008080;">81</span>          
<span style="color: #008080;">82</span> <span style="color: #000000;">        example.createCriteria().andUidEqualTo(user.getId());
</span><span style="color: #008080;">83</span>         List&lt;UserRole&gt; userRoles=<span style="color: #000000;"> userRoleMapper.selectByExample(example);
</span><span style="color: #008080;">84</span>          
<span style="color: #008080;">85</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (UserRole userRole : userRoles) {
</span><span style="color: #008080;">86</span>             Role role=<span style="color: #000000;">roleMapper.selectByPrimaryKey(userRole.getRid());
</span><span style="color: #008080;">87</span> <span style="color: #000000;">            roles.add(role);
</span><span style="color: #008080;">88</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">89</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> roles;
</span><span style="color: #008080;">90</span> <span style="color: #000000;">    }  
</span><span style="color: #008080;">91</span>      
<span style="color: #008080;">92</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>UserRoleServiceImpl</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('9bf2a315-87ec-4aae-bc79-aecbc2d4a136')"><img id="code_img_closed_9bf2a315-87ec-4aae-bc79-aecbc2d4a136" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_9bf2a315-87ec-4aae-bc79-aecbc2d4a136" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9bf2a315-87ec-4aae-bc79-aecbc2d4a136',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_9bf2a315-87ec-4aae-bc79-aecbc2d4a136" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service.impl;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Service;
</span><span style="color: #008080;"> 7</span>  
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.UserRoleMapper;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.UserRole;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.UserRoleExample;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserRoleService;
</span><span style="color: #008080;">14</span>  
<span style="color: #008080;">15</span> <span style="color: #000000;">@Service
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserRoleServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> UserRoleService{
</span><span style="color: #008080;">17</span>  
<span style="color: #008080;">18</span> <span style="color: #000000;">    @Autowired UserRoleMapper userRoleMapper;
</span><span style="color: #008080;">19</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">20</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setRoles(User user, <span style="color: #0000ff;">long</span><span style="color: #000000;">[] roleIds) {
</span><span style="color: #008080;">21</span>         <span style="color: #008000;">//</span><span style="color: #008000;">删除当前用户所有的角色</span>
<span style="color: #008080;">22</span>         UserRoleExample example= <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserRoleExample();
</span><span style="color: #008080;">23</span> <span style="color: #000000;">        example.createCriteria().andUidEqualTo(user.getId());
</span><span style="color: #008080;">24</span>         List&lt;UserRole&gt; urs=<span style="color: #000000;"> userRoleMapper.selectByExample(example);
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (UserRole userRole : urs)
</span><span style="color: #008080;">26</span> <span style="color: #000000;">            userRoleMapper.deleteByPrimaryKey(userRole.getId());
</span><span style="color: #008080;">27</span>  
<span style="color: #008080;">28</span>         <span style="color: #008000;">//</span><span style="color: #008000;">设置新的角色关系</span>
<span style="color: #008080;">29</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span>!=<span style="color: #000000;">roleIds)
</span><span style="color: #008080;">30</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">long</span><span style="color: #000000;"> rid : roleIds) {
</span><span style="color: #008080;">31</span>                 UserRole userRole = <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserRole();
</span><span style="color: #008080;">32</span> <span style="color: #000000;">                userRole.setRid(rid);
</span><span style="color: #008080;">33</span> <span style="color: #000000;">                userRole.setUid(user.getId());
</span><span style="color: #008080;">34</span> <span style="color: #000000;">                userRoleMapper.insert(userRole);
</span><span style="color: #008080;">35</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">38</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByUser(<span style="color: #0000ff;">long</span><span style="color: #000000;"> userId) {
</span><span style="color: #008080;">39</span>         UserRoleExample example= <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserRoleExample();
</span><span style="color: #008080;">40</span> <span style="color: #000000;">        example.createCriteria().andUidEqualTo(userId);
</span><span style="color: #008080;">41</span>         List&lt;UserRole&gt; urs=<span style="color: #000000;"> userRoleMapper.selectByExample(example);
</span><span style="color: #008080;">42</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (UserRole userRole : urs) {
</span><span style="color: #008080;">43</span> <span style="color: #000000;">            userRoleMapper.deleteByPrimaryKey(userRole.getId());
</span><span style="color: #008080;">44</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">45</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">46</span> <span style="color: #000000;">    @Override  
</span><span style="color: #008080;">47</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> deleteByRole(<span style="color: #0000ff;">long</span><span style="color: #000000;"> roleId) {
</span><span style="color: #008080;">48</span>         UserRoleExample example= <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserRoleExample();
</span><span style="color: #008080;">49</span> <span style="color: #000000;">        example.createCriteria().andRidEqualTo(roleId);
</span><span style="color: #008080;">50</span>         List&lt;UserRole&gt; urs=<span style="color: #000000;"> userRoleMapper.selectByExample(example);
</span><span style="color: #008080;">51</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (UserRole userRole : urs) {
</span><span style="color: #008080;">52</span> <span style="color: #000000;">            userRoleMapper.deleteByPrimaryKey(userRole.getId());
</span><span style="color: #008080;">53</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">54</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">55</span>  
<span style="color: #008080;">56</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>UserServiceImpl</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('48c0b9ac-718b-4db6-9d52-944725e1b64c')"><img id="code_img_closed_48c0b9ac-718b-4db6-9d52-944725e1b64c" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_48c0b9ac-718b-4db6-9d52-944725e1b64c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('48c0b9ac-718b-4db6-9d52-944725e1b64c',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_48c0b9ac-718b-4db6-9d52-944725e1b64c" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.service.impl;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Service;
</span><span style="color: #008080;"> 7</span>  
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.mapper.UserMapper;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.UserExample;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserRoleService;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserService;
</span><span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> <span style="color: #000000;">@Service
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> UserServiceImpl  <span style="color: #0000ff;">implements</span><span style="color: #000000;"> UserService{
</span><span style="color: #008080;">16</span>  
<span style="color: #008080;">17</span> <span style="color: #000000;">    @Autowired UserMapper userMapper;
</span><span style="color: #008080;">18</span> <span style="color: #000000;">    @Autowired UserRoleService userRoleService;
</span><span style="color: #008080;">19</span>      
<span style="color: #008080;">20</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">21</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getPassword(String name) {
</span><span style="color: #008080;">22</span>         User user =<span style="color: #000000;"> getByName(name);
</span><span style="color: #008080;">23</span>         <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">null</span>==<span style="color: #000000;">user)
</span><span style="color: #008080;">24</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">25</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> user.getPassword();
</span><span style="color: #008080;">26</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">27</span>  
<span style="color: #008080;">28</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">29</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> User getByName(String name) {
</span><span style="color: #008080;">30</span>         UserExample example = <span style="color: #0000ff;">new</span><span style="color: #000000;"> UserExample();
</span><span style="color: #008080;">31</span> <span style="color: #000000;">        example.createCriteria().andNameEqualTo(name);
</span><span style="color: #008080;">32</span>         List&lt;User&gt; users =<span style="color: #000000;"> userMapper.selectByExample(example);
</span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;">(users.isEmpty())
</span><span style="color: #008080;">34</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;">35</span>         <span style="color: #0000ff;">return</span> users.get(0<span style="color: #000000;">);
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span>      
<span style="color: #008080;">38</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">39</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> add(User u) {
</span><span style="color: #008080;">40</span> <span style="color: #000000;">        userMapper.insert(u);
</span><span style="color: #008080;">41</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">42</span>   
<span style="color: #008080;">43</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">44</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> delete(Long id) {
</span><span style="color: #008080;">45</span> <span style="color: #000000;">        userMapper.deleteByPrimaryKey(id);
</span><span style="color: #008080;">46</span> <span style="color: #000000;">        userRoleService.deleteByUser(id);
</span><span style="color: #008080;">47</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">48</span>   
<span style="color: #008080;">49</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">50</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> update(User u) {
</span><span style="color: #008080;">51</span> <span style="color: #000000;">        userMapper.updateByPrimaryKeySelective(u);
</span><span style="color: #008080;">52</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">53</span>   
<span style="color: #008080;">54</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">55</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> User get(Long id) {
</span><span style="color: #008080;">56</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> userMapper.selectByPrimaryKey(id);
</span><span style="color: #008080;">57</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">58</span>   
<span style="color: #008080;">59</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">60</span>     <span style="color: #0000ff;">public</span> List&lt;User&gt;<span style="color: #000000;"> list(){
</span><span style="color: #008080;">61</span>         UserExample example =<span style="color: #0000ff;">new</span><span style="color: #000000;"> UserExample();
</span><span style="color: #008080;">62</span>         example.setOrderByClause("id desc"<span style="color: #000000;">);
</span><span style="color: #008080;">63</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> userMapper.selectByExample(example);
</span><span style="color: #008080;">64</span>   
<span style="color: #008080;">65</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">66</span>  
<span style="color: #008080;">67</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>Controller 层</h2>
<p>LoginController</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('8b6754e8-2b08-4f87-ae0b-7733086590e0')"><img id="code_img_closed_8b6754e8-2b08-4f87-ae0b-7733086590e0" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_8b6754e8-2b08-4f87-ae0b-7733086590e0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('8b6754e8-2b08-4f87-ae0b-7733086590e0',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_8b6754e8-2b08-4f87-ae0b-7733086590e0" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.controller;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.SecurityUtils;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.AuthenticationException;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.UsernamePasswordToken;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.session.Session;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.subject.Subject;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.ui.Model;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMethod;
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #000000;">@Controller
</span><span style="color: #008080;">15</span> @RequestMapping(""<span style="color: #000000;">)
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> LoginController {
</span><span style="color: #008080;">17</span>     @RequestMapping(value="/login",method=<span style="color: #000000;">RequestMethod.POST) 
</span><span style="color: #008080;">18</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String login(Model model,String name, String password) {
</span><span style="color: #008080;">19</span>         Subject subject =<span style="color: #000000;"> SecurityUtils.getSubject();  
</span><span style="color: #008080;">20</span>         UsernamePasswordToken token = <span style="color: #0000ff;">new</span><span style="color: #000000;"> UsernamePasswordToken(name, password);  
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {  
</span><span style="color: #008080;">22</span> <span style="color: #000000;">            subject.login(token);
</span><span style="color: #008080;">23</span>             Session session=<span style="color: #000000;">subject.getSession();
</span><span style="color: #008080;">24</span>             session.setAttribute("subject"<span style="color: #000000;">, subject);
</span><span style="color: #008080;">25</span>             <span style="color: #0000ff;">return</span> "redirect:index"<span style="color: #000000;">;
</span><span style="color: #008080;">26</span>             
<span style="color: #008080;">27</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (AuthenticationException e) {  
</span><span style="color: #008080;">28</span>             model.addAttribute("error", "验证失败"<span style="color: #000000;">);  
</span><span style="color: #008080;">29</span>             <span style="color: #0000ff;">return</span> "login"<span style="color: #000000;">; 
</span><span style="color: #008080;">30</span> <span style="color: #000000;">        }  
</span><span style="color: #008080;">31</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">32</span>     
<span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span> 
<span style="color: #008080;">35</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>PageController</p>
<p>上面已贴</p>
<p>PermissionController</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('6fb78f1b-fa89-4d90-871a-44ad589e2edd')"><img id="code_img_closed_6fb78f1b-fa89-4d90-871a-44ad589e2edd" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_6fb78f1b-fa89-4d90-871a-44ad589e2edd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('6fb78f1b-fa89-4d90-871a-44ad589e2edd',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_6fb78f1b-fa89-4d90-871a-44ad589e2edd" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.controller;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.ui.Model;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;
</span><span style="color: #008080;"> 9</span>  
<span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Permission;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.PermissionService;
</span><span style="color: #008080;">12</span>  
<span style="color: #008080;">13</span> <span style="color: #000000;">@Controller
</span><span style="color: #008080;">14</span> @RequestMapping("config"<span style="color: #000000;">)
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> PermissionController {
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    @Autowired PermissionService permissionService;
</span><span style="color: #008080;">17</span>      
<span style="color: #008080;">18</span>     @RequestMapping("listPermission"<span style="color: #000000;">)
</span><span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String list(Model model){
</span><span style="color: #008080;">20</span>         List&lt;Permission&gt; ps=<span style="color: #000000;"> permissionService.list();
</span><span style="color: #008080;">21</span>         model.addAttribute("ps"<span style="color: #000000;">, ps);
</span><span style="color: #008080;">22</span>         <span style="color: #0000ff;">return</span> "listPermission"<span style="color: #000000;">;
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">24</span>     @RequestMapping("editPermission"<span style="color: #000000;">)
</span><span style="color: #008080;">25</span>     <span style="color: #0000ff;">public</span> String list(Model model,<span style="color: #0000ff;">long</span><span style="color: #000000;"> id){
</span><span style="color: #008080;">26</span>         Permission permission =<span style="color: #000000;">permissionService.get(id);
</span><span style="color: #008080;">27</span>         model.addAttribute("permission"<span style="color: #000000;">, permission);
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">return</span> "editPermission"<span style="color: #000000;">;
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">30</span>     @RequestMapping("updatePermission"<span style="color: #000000;">)
</span><span style="color: #008080;">31</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String update(Permission permission){
</span><span style="color: #008080;">32</span>  
<span style="color: #008080;">33</span> <span style="color: #000000;">        permissionService.update(permission);
</span><span style="color: #008080;">34</span>         <span style="color: #0000ff;">return</span> "redirect:listPermission"<span style="color: #000000;">;
</span><span style="color: #008080;">35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">36</span>  
<span style="color: #008080;">37</span>     @RequestMapping("addPermission"<span style="color: #000000;">)
</span><span style="color: #008080;">38</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String list(Model model,Permission permission){
</span><span style="color: #008080;">39</span> <span style="color: #000000;">        System.out.println(permission.getName());
</span><span style="color: #008080;">40</span> <span style="color: #000000;">        System.out.println(permission.getDesc_());
</span><span style="color: #008080;">41</span> <span style="color: #000000;">        permissionService.add(permission);
</span><span style="color: #008080;">42</span>         <span style="color: #0000ff;">return</span> "redirect:listPermission"<span style="color: #000000;">;
</span><span style="color: #008080;">43</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">44</span>     @RequestMapping("deletePermission"<span style="color: #000000;">)
</span><span style="color: #008080;">45</span>     <span style="color: #0000ff;">public</span> String delete(Model model,<span style="color: #0000ff;">long</span><span style="color: #000000;"> id){
</span><span style="color: #008080;">46</span> <span style="color: #000000;">        permissionService.delete(id);
</span><span style="color: #008080;">47</span>         <span style="color: #0000ff;">return</span> "redirect:listPermission"<span style="color: #000000;">;
</span><span style="color: #008080;">48</span> <span style="color: #000000;">    }   
</span><span style="color: #008080;">49</span>  
<span style="color: #008080;">50</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>RoleController</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('0467ef0b-eedb-427d-8c7d-17cd5ff5f6d5')"><img id="code_img_closed_0467ef0b-eedb-427d-8c7d-17cd5ff5f6d5" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_0467ef0b-eedb-427d-8c7d-17cd5ff5f6d5" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0467ef0b-eedb-427d-8c7d-17cd5ff5f6d5',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_0467ef0b-eedb-427d-8c7d-17cd5ff5f6d5" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.controller;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Arrays;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashMap;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Map;
</span><span style="color: #008080;"> 7</span>  
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.ui.Model;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;
</span><span style="color: #008080;">12</span>  
<span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Permission;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.PermissionService;
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RolePermissionService;
</span><span style="color: #008080;">17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RoleService;
</span><span style="color: #008080;">18</span>  
<span style="color: #008080;">19</span> <span style="color: #000000;">@Controller
</span><span style="color: #008080;">20</span> @RequestMapping("config"<span style="color: #000000;">)
</span><span style="color: #008080;">21</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> RoleController {
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    @Autowired RoleService roleService;
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    @Autowired RolePermissionService rolePermissionService;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    @Autowired PermissionService permissionService;
</span><span style="color: #008080;">25</span>      
<span style="color: #008080;">26</span>     @RequestMapping("listRole"<span style="color: #000000;">)
</span><span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String list(Model model){
</span><span style="color: #008080;">28</span>         List&lt;Role&gt; rs=<span style="color: #000000;"> roleService.list();
</span><span style="color: #008080;">29</span>         model.addAttribute("rs"<span style="color: #000000;">, rs);
</span><span style="color: #008080;">30</span>          
<span style="color: #008080;">31</span>         Map&lt;Role,List&lt;Permission&gt;&gt; role_permissions = <span style="color: #0000ff;">new</span> HashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">32</span>          
<span style="color: #008080;">33</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (Role role : rs) {
</span><span style="color: #008080;">34</span>             List&lt;Permission&gt; ps =<span style="color: #000000;"> permissionService.list(role);
</span><span style="color: #008080;">35</span> <span style="color: #000000;">            role_permissions.put(role, ps);
</span><span style="color: #008080;">36</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">37</span>         model.addAttribute("role_permissions"<span style="color: #000000;">, role_permissions);
</span><span style="color: #008080;">38</span>  
<span style="color: #008080;">39</span>         <span style="color: #0000ff;">return</span> "listRole"<span style="color: #000000;">;
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">41</span>     @RequestMapping("editRole"<span style="color: #000000;">)
</span><span style="color: #008080;">42</span>     <span style="color: #0000ff;">public</span> String list(Model model,<span style="color: #0000ff;">long</span><span style="color: #000000;"> id){
</span><span style="color: #008080;">43</span>         Role role =<span style="color: #000000;">roleService.get(id);
</span><span style="color: #008080;">44</span>         model.addAttribute("role"<span style="color: #000000;">, role);
</span><span style="color: #008080;">45</span>          
<span style="color: #008080;">46</span>         List&lt;Permission&gt; ps =<span style="color: #000000;"> permissionService.list();
</span><span style="color: #008080;">47</span>         model.addAttribute("ps"<span style="color: #000000;">, ps);
</span><span style="color: #008080;">48</span>  
<span style="color: #008080;">49</span>         List&lt;Permission&gt; currentPermissions =<span style="color: #000000;"> permissionService.list(role);
</span><span style="color: #008080;">50</span>         model.addAttribute("currentPermissions"<span style="color: #000000;">, currentPermissions);
</span><span style="color: #008080;">51</span>          
<span style="color: #008080;">52</span>         <span style="color: #0000ff;">return</span> "editRole"<span style="color: #000000;">;
</span><span style="color: #008080;">53</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">54</span>     @RequestMapping("updateRole"<span style="color: #000000;">)
</span><span style="color: #008080;">55</span>     <span style="color: #0000ff;">public</span> String update(Role role,<span style="color: #0000ff;">long</span><span style="color: #000000;">[] permissionIds){
</span><span style="color: #008080;">56</span> <span style="color: #000000;">        rolePermissionService.setPermissions(role, permissionIds);
</span><span style="color: #008080;">57</span> <span style="color: #000000;">        roleService.update(role);
</span><span style="color: #008080;">58</span>         <span style="color: #0000ff;">return</span> "redirect:listRole"<span style="color: #000000;">;
</span><span style="color: #008080;">59</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">60</span>  
<span style="color: #008080;">61</span>     @RequestMapping("addRole"<span style="color: #000000;">)
</span><span style="color: #008080;">62</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String list(Model model,Role role){
</span><span style="color: #008080;">63</span> <span style="color: #000000;">        System.out.println(role.getName());
</span><span style="color: #008080;">64</span> <span style="color: #000000;">        System.out.println(role.getDesc_());
</span><span style="color: #008080;">65</span> <span style="color: #000000;">        roleService.add(role);
</span><span style="color: #008080;">66</span>         <span style="color: #0000ff;">return</span> "redirect:listRole"<span style="color: #000000;">;
</span><span style="color: #008080;">67</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">68</span>     @RequestMapping("deleteRole"<span style="color: #000000;">)
</span><span style="color: #008080;">69</span>     <span style="color: #0000ff;">public</span> String delete(Model model,<span style="color: #0000ff;">long</span><span style="color: #000000;"> id){
</span><span style="color: #008080;">70</span> <span style="color: #000000;">        roleService.delete(id);
</span><span style="color: #008080;">71</span>         <span style="color: #0000ff;">return</span> "redirect:listRole"<span style="color: #000000;">;
</span><span style="color: #008080;">72</span> <span style="color: #000000;">    }   
</span><span style="color: #008080;">73</span>  
<span style="color: #008080;">74</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p>UserController</p>
<src class="cnblogs_code" onclick="cnblogs_code_show('2ec95a43-abfe-4f96-9fc8-d5cb60cdf88a')"><img id="code_img_closed_2ec95a43-abfe-4f96-9fc8-d5cb60cdf88a" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_2ec95a43-abfe-4f96-9fc8-d5cb60cdf88a" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('2ec95a43-abfe-4f96-9fc8-d5cb60cdf88a',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_2ec95a43-abfe-4f96-9fc8-d5cb60cdf88a" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.controller;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.HashMap;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Map;
</span><span style="color: #008080;"> 6</span>  
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.crypto.SecureRandomNumberGenerator;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.crypto.hash.SimpleHash;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.stereotype.Controller;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.ui.Model;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.RequestMapping;
</span><span style="color: #008080;">13</span>  
<span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.Role;
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RoleService;
</span><span style="color: #008080;">17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserRoleService;
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserService;
</span><span style="color: #008080;">19</span>  
<span style="color: #008080;">20</span> <span style="color: #000000;">@Controller
</span><span style="color: #008080;">21</span> @RequestMapping("config"<span style="color: #000000;">)
</span><span style="color: #008080;">22</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> UserController {
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    @Autowired UserRoleService userRoleService;
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    @Autowired UserService userService;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    @Autowired RoleService roleService;
</span><span style="color: #008080;">26</span>      
<span style="color: #008080;">27</span>     @RequestMapping("listUser"<span style="color: #000000;">)
</span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String list(Model model){
</span><span style="color: #008080;">29</span>         List&lt;User&gt; us=<span style="color: #000000;"> userService.list();
</span><span style="color: #008080;">30</span>         model.addAttribute("us"<span style="color: #000000;">, us);
</span><span style="color: #008080;">31</span>         Map&lt;User,List&lt;Role&gt;&gt; user_roles = <span style="color: #0000ff;">new</span> HashMap&lt;&gt;<span style="color: #000000;">();
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">for</span><span style="color: #000000;"> (User user : us) {
</span><span style="color: #008080;">33</span>             List&lt;Role&gt; roles=<span style="color: #000000;">roleService.listRoles(user);
</span><span style="color: #008080;">34</span> <span style="color: #000000;">            user_roles.put(user, roles);
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">36</span>         model.addAttribute("user_roles"<span style="color: #000000;">, user_roles);
</span><span style="color: #008080;">37</span>  
<span style="color: #008080;">38</span>         <span style="color: #0000ff;">return</span> "listUser"<span style="color: #000000;">;
</span><span style="color: #008080;">39</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">40</span>     @RequestMapping("editUser"<span style="color: #000000;">)
</span><span style="color: #008080;">41</span>     <span style="color: #0000ff;">public</span> String edit(Model model,<span style="color: #0000ff;">long</span><span style="color: #000000;"> id){
</span><span style="color: #008080;">42</span>         List&lt;Role&gt; rs =<span style="color: #000000;"> roleService.list();
</span><span style="color: #008080;">43</span>         model.addAttribute("rs"<span style="color: #000000;">, rs);      
</span><span style="color: #008080;">44</span>         User user =<span style="color: #000000;">userService.get(id);
</span><span style="color: #008080;">45</span>         model.addAttribute("user"<span style="color: #000000;">, user);
</span><span style="color: #008080;">46</span>          
<span style="color: #008080;">47</span>         List&lt;Role&gt; roles =<span style="color: #000000;">roleService.listRoles(user);
</span><span style="color: #008080;">48</span>         model.addAttribute("currentRoles"<span style="color: #000000;">, roles);
</span><span style="color: #008080;">49</span>          
<span style="color: #008080;">50</span>         <span style="color: #0000ff;">return</span> "editUser"<span style="color: #000000;">;
</span><span style="color: #008080;">51</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">52</span>     @RequestMapping("deleteUser"<span style="color: #000000;">)
</span><span style="color: #008080;">53</span>     <span style="color: #0000ff;">public</span> String delete(Model model,<span style="color: #0000ff;">long</span><span style="color: #000000;"> id){
</span><span style="color: #008080;">54</span> <span style="color: #000000;">        userService.delete(id);
</span><span style="color: #008080;">55</span>         <span style="color: #0000ff;">return</span> "redirect:listUser"<span style="color: #000000;">;
</span><span style="color: #008080;">56</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">57</span>     @RequestMapping("updateUser"<span style="color: #000000;">)
</span><span style="color: #008080;">58</span>     <span style="color: #0000ff;">public</span> String update(User user,<span style="color: #0000ff;">long</span><span style="color: #000000;">[] roleIds){
</span><span style="color: #008080;">59</span> <span style="color: #000000;">        userRoleService.setRoles(user,roleIds);
</span><span style="color: #008080;">60</span>          
<span style="color: #008080;">61</span>         String password=<span style="color: #000000;">user.getPassword();
</span><span style="color: #008080;">62</span>         <span style="color: #008000;">//</span><span style="color: #008000;">如果在修改的时候没有设置密码，就表示不改动密码</span>
<span style="color: #008080;">63</span>         <span style="color: #0000ff;">if</span>(user.getPassword().length()!=0<span style="color: #000000;">) {
</span><span style="color: #008080;">64</span>             String salt = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SecureRandomNumberGenerator().nextBytes().toString();
</span><span style="color: #008080;">65</span>             <span style="color: #0000ff;">int</span> times = 2<span style="color: #000000;">;
</span><span style="color: #008080;">66</span>             String algorithmName = "md5"<span style="color: #000000;">;
</span><span style="color: #008080;">67</span>             String encodedPassword = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimpleHash(algorithmName,password,salt,times).toString();
</span><span style="color: #008080;">68</span> <span style="color: #000000;">            user.setSalt(salt);
</span><span style="color: #008080;">69</span> <span style="color: #000000;">            user.setPassword(encodedPassword);
</span><span style="color: #008080;">70</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">71</span>         <span style="color: #0000ff;">else</span>
<span style="color: #008080;">72</span>             user.setPassword(<span style="color: #0000ff;">null</span><span style="color: #000000;">);
</span><span style="color: #008080;">73</span>          
<span style="color: #008080;">74</span> <span style="color: #000000;">        userService.update(user);
</span><span style="color: #008080;">75</span>  
<span style="color: #008080;">76</span>         <span style="color: #0000ff;">return</span> "redirect:listUser"<span style="color: #000000;">;
</span><span style="color: #008080;">77</span>  
<span style="color: #008080;">78</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">79</span>  
<span style="color: #008080;">80</span>     @RequestMapping("addUser"<span style="color: #000000;">)
</span><span style="color: #008080;">81</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String add(Model model,String name, String password){
</span><span style="color: #008080;">82</span>          
<span style="color: #008080;">83</span>         String salt = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SecureRandomNumberGenerator().nextBytes().toString();
</span><span style="color: #008080;">84</span>         <span style="color: #0000ff;">int</span> times = 2<span style="color: #000000;">;
</span><span style="color: #008080;">85</span>         String algorithmName = "md5"<span style="color: #000000;">;
</span><span style="color: #008080;">86</span>           
<span style="color: #008080;">87</span>         String encodedPassword = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimpleHash(algorithmName,password,salt,times).toString();
</span><span style="color: #008080;">88</span>          
<span style="color: #008080;">89</span>         User u = <span style="color: #0000ff;">new</span><span style="color: #000000;"> User();
</span><span style="color: #008080;">90</span> <span style="color: #000000;">        u.setName(name);
</span><span style="color: #008080;">91</span> <span style="color: #000000;">        u.setPassword(encodedPassword);
</span><span style="color: #008080;">92</span> <span style="color: #000000;">        u.setSalt(salt);
</span><span style="color: #008080;">93</span> <span style="color: #000000;">        userService.add(u);
</span><span style="color: #008080;">94</span>          
<span style="color: #008080;">95</span>         <span style="color: #0000ff;">return</span> "redirect:listUser"<span style="color: #000000;">;
</span><span style="color: #008080;">96</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">97</span>  
<span style="color: #008080;">98</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>DatabaseRealm</h2>
<p><span style="font-family: 宋体;">代码如下:</span></p>
<src class="cnblogs_code" onclick="cnblogs_code_show('4e194e97-00e7-4c00-8910-b3e914983859')"><img id="code_img_closed_4e194e97-00e7-4c00-8910-b3e914983859" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_4e194e97-00e7-4c00-8910-b3e914983859" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4e194e97-00e7-4c00-8910-b3e914983859',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_4e194e97-00e7-4c00-8910-b3e914983859" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.realm;
</span><span style="color: #008080;"> 2</span>  
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Set;
</span><span style="color: #008080;"> 4</span>  
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.AuthenticationException;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.AuthenticationInfo;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.AuthenticationToken;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.SimpleAuthenticationInfo;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authc.UsernamePasswordToken;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authz.AuthorizationInfo;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authz.SimpleAuthorizationInfo;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.codec.CodecException;
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.crypto.UnknownAlgorithmException;
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.crypto.hash.SimpleHash;
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.realm.AuthorizingRealm;
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.subject.PrincipalCollection;
</span><span style="color: #008080;">17</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.util.ByteSource;
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.beans.factory.annotation.Autowired;
</span><span style="color: #008080;">19</span>  
<span style="color: #008080;">20</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.pojo.User;
</span><span style="color: #008080;">21</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.PermissionService;
</span><span style="color: #008080;">22</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.RoleService;
</span><span style="color: #008080;">23</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.how2java.service.UserService;
</span><span style="color: #008080;">24</span>  
<span style="color: #008080;">25</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> DatabaseRealm <span style="color: #0000ff;">extends</span><span style="color: #000000;"> AuthorizingRealm {
</span><span style="color: #008080;">26</span>  
<span style="color: #008080;">27</span> <span style="color: #000000;">    @Autowired
</span><span style="color: #008080;">28</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> UserService userService;
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    @Autowired
</span><span style="color: #008080;">30</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> RoleService roleService;
</span><span style="color: #008080;">31</span> <span style="color: #000000;">    @Autowired
</span><span style="color: #008080;">32</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> PermissionService permissionService;
</span><span style="color: #008080;">33</span>      
<span style="color: #008080;">34</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">35</span>     <span style="color: #0000ff;">protected</span><span style="color: #000000;"> AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) {
</span><span style="color: #008080;">36</span>         <span style="color: #008000;">//</span><span style="color: #008000;">能进入到这里，表示账号已经通过验证了</span>
<span style="color: #008080;">37</span>         String userName =<span style="color: #000000;">(String) principalCollection.getPrimaryPrincipal();
</span><span style="color: #008080;">38</span>         <span style="color: #008000;">//</span><span style="color: #008000;">通过service获取角色和权限</span>
<span style="color: #008080;">39</span>         Set&lt;String&gt; permissions =<span style="color: #000000;"> permissionService.listPermissions(userName);
</span><span style="color: #008080;">40</span>         Set&lt;String&gt; roles =<span style="color: #000000;"> roleService.listRoleNames(userName);
</span><span style="color: #008080;">41</span>          
<span style="color: #008080;">42</span>         <span style="color: #008000;">//</span><span style="color: #008000;">授权对象</span>
<span style="color: #008080;">43</span>         SimpleAuthorizationInfo s = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimpleAuthorizationInfo();
</span><span style="color: #008080;">44</span>         <span style="color: #008000;">//</span><span style="color: #008000;">把通过service获取到的角色和权限放进去</span>
<span style="color: #008080;">45</span> <span style="color: #000000;">        s.setStringPermissions(permissions);
</span><span style="color: #008080;">46</span> <span style="color: #000000;">        s.setRoles(roles);
</span><span style="color: #008080;">47</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> s;
</span><span style="color: #008080;">48</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">49</span>  
<span style="color: #008080;">50</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">51</span>     <span style="color: #0000ff;">protected</span> AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> AuthenticationException {
</span><span style="color: #008080;">52</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获取账号密码</span>
<span style="color: #008080;">53</span>         UsernamePasswordToken t =<span style="color: #000000;"> (UsernamePasswordToken) token;
</span><span style="color: #008080;">54</span>         String userName=<span style="color: #000000;"> token.getPrincipal().toString();
</span><span style="color: #008080;">55</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获取数据库中的密码</span>
<span style="color: #008080;">56</span>         User user =<span style="color: #000000;">userService.getByName(userName);
</span><span style="color: #008080;">57</span>         String passwordInDB =<span style="color: #000000;"> user.getPassword();
</span><span style="color: #008080;">58</span>         String salt =<span style="color: #000000;"> user.getSalt();
</span><span style="color: #008080;">59</span>         <span style="color: #008000;">//</span><span style="color: #008000;">认证信息里存放账号密码, getName() 是当前Realm的继承方法,通常返回当前类名 :databaseRealm
</span><span style="color: #008080;">60</span>         <span style="color: #008000;">//</span><span style="color: #008000;">盐也放进去
</span><span style="color: #008080;">61</span>         <span style="color: #008000;">//</span><span style="color: #008000;">这样通过applicationContext-shiro.xml里配置的 HashedCredentialsMatcher 进行自动校验</span>
<span style="color: #008080;">62</span>         SimpleAuthenticationInfo a = <span style="color: #0000ff;">new</span><span style="color: #000000;"> SimpleAuthenticationInfo(userName,passwordInDB,ByteSource.Util.bytes(salt),getName());
</span><span style="color: #008080;">63</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> a;
</span><span style="color: #008080;">64</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">65</span>  
<span style="color: #008080;">66</span> <span style="color: #000000;">}
</span><span style="color: #008080;">67</span> <span style="color: #000000;">DefaultExceptionHandler
</span><span style="color: #008080;">68</span> <span style="color: #000000;">代码如下：
</span><span style="color: #008080;">69</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.exception;
</span><span style="color: #008080;">70</span> 
<span style="color: #008080;">71</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authz.UnauthorizedException;
</span><span style="color: #008080;">72</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.http.HttpStatus;
</span><span style="color: #008080;">73</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ControllerAdvice;
</span><span style="color: #008080;">74</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ExceptionHandler;
</span><span style="color: #008080;">75</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ResponseStatus;
</span><span style="color: #008080;">76</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.context.request.NativeWebRequest;
</span><span style="color: #008080;">77</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.ModelAndView;
</span><span style="color: #008080;">78</span> 
<span style="color: #008080;">79</span> <span style="color: #000000;">@ControllerAdvice
</span><span style="color: #008080;">80</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DefaultExceptionHandler {
</span><span style="color: #008080;">81</span>     @ExceptionHandler({UnauthorizedException.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span><span style="color: #008080;">82</span> <span style="color: #000000;">    @ResponseStatus(HttpStatus.UNAUTHORIZED)
</span><span style="color: #008080;">83</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> ModelAndView processUnauthenticatedException(NativeWebRequest request, UnauthorizedException e) {
</span><span style="color: #008080;">84</span>         ModelAndView mv = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ModelAndView();
</span><span style="color: #008080;">85</span>         mv.addObject("ex"<span style="color: #000000;">, e);
</span><span style="color: #008080;">86</span>         mv.setViewName("unauthorized"<span style="color: #000000;">);
</span><span style="color: #008080;">87</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> mv;
</span><span style="color: #008080;">88</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">89</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<h2>DefaultExceptionHandler</h2>
<src class="cnblogs_code" onclick="cnblogs_code_show('0043c5a8-fa23-44d6-b7df-add702f4e4fc')"><img id="code_img_closed_0043c5a8-fa23-44d6-b7df-add702f4e4fc" class="code_img_closed" src="./images/Shiro集成SSM基于URL权限管理(一)0.png" alt="" /><img id="code_img_opened_0043c5a8-fa23-44d6-b7df-add702f4e4fc" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0043c5a8-fa23-44d6-b7df-add702f4e4fc',event)" src="./images/Shiro集成SSM基于URL权限管理(一)1.png" alt="" />
<src id="cnblogs_code_open_0043c5a8-fa23-44d6-b7df-add702f4e4fc" class="cnblogs_code_hide">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> com.how2java.exception;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.apache.shiro.authz.UnauthorizedException;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.http.HttpStatus;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ControllerAdvice;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ExceptionHandler;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.bind.annotation.ResponseStatus;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.context.request.NativeWebRequest;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.web.servlet.ModelAndView;
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #000000;">@ControllerAdvice
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> DefaultExceptionHandler {
</span><span style="color: #008080;">13</span>     @ExceptionHandler({UnauthorizedException.<span style="color: #0000ff;">class</span><span style="color: #000000;">})
</span><span style="color: #008080;">14</span> <span style="color: #000000;">    @ResponseStatus(HttpStatus.UNAUTHORIZED)
</span><span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> ModelAndView processUnauthenticatedException(NativeWebRequest request, UnauthorizedException e) {
</span><span style="color: #008080;">16</span>         ModelAndView mv = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ModelAndView();
</span><span style="color: #008080;">17</span>         mv.addObject("ex"<span style="color: #000000;">, e);
</span><span style="color: #008080;">18</span>         mv.setViewName("unauthorized"<span style="color: #000000;">);
</span><span style="color: #008080;">19</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> mv;
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">21</span> }</code></pre>

<span class="cnblogs_code_collapse">View Code</span>
<p><a href="http://127.0.0.1:8080/shirossm/config/listUser"><span>http://127.0.0.1:8080/shirossm/config/listUser</span></a></p>
<p><a href="http://127.0.0.1:8080/shirossm/index"><span style="text-decoration: underline;">http://127.0.0.1:8080/shirossm/index</span></a></p>
<p>项目名不一致的话自行修改。</p>
<p><img src="./images/Shiro集成SSM基于URL权限管理(一)85.png" alt="" /></p>
<p><img src="./images/Shiro集成SSM基于URL权限管理(一)86.png" alt="" /></p>
<p><span style="font-family: Helvetica;">不过此时的权限还是通过注解</span>@RequiresRoles、@RequiresPermissions<span style="font-family: Helvetica;">实现，而非动态</span>url.。之后会在此基础上实现动态url了<span style="font-family: 宋体;">。</span></p>
<p><strong><span style="font-family: 宋体;">基本代码都贴出来了。如有需要demo源码，请留言，互相交流学习乐意分享。</span></strong></p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>