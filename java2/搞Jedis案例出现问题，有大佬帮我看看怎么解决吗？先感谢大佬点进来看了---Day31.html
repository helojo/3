<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修搞Jedis案例出现问题，有大佬帮我看看怎么解决吗？先感谢大佬点进来看了---Day31' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>搞Jedis案例出现问题，有大佬帮我看看怎么解决吗？先感谢大佬点进来看了---Day31</center></div><div class='banquan'>原文出处:本文由博客园博主CeliaTodd提供。<br/>
原文连接:https://www.cnblogs.com/hpcz190911/p/12004053.html</div><br>
    <p><span style="font-size: 18px;">今天学了Jedis的相关内容,然后做了一个案例,但是出现了错误，然后我百度了一晚上没有解决，想到看看发个博客能不能有大佬帮我看一下问题出现在哪里，百度了一晚上有点懵逼。求大佬帮我解决，在这小弟我先万分感谢大佬们点进来帮我看，感谢大佬们~</span></p>
<p><span style="font-size: 18px;"><strong>下面是案例需求</strong>：</span></p>
<p><span style="font-size: 18px;">　　案例需求：</span><br /><span style="font-size: 18px;">	　　　　1. 提供index.html页面，页面中有一个省份 下拉列表</span><br /><span style="font-size: 18px;">	　　　　2. 当 页面加载完成后 发送ajax请求，加载所有省份</span></p>
<p><span style="font-size: 18px;">出现的错误：为啥不一样的浏览器会出现不一样的错误，我都被搞懵了，这是要学到放弃啊~但是我不会放弃的，求大佬帮我看看哪里出问题了🙏🙏</span></p>
<p><span style="font-size: 18px;">　　chrome浏览器出现的错误</span></p>
<p><span style="font-size: 18px;"><img src="./images/搞Jedis案例出现问题，有大佬帮我看看怎么解决吗？先感谢大佬点进来看了---Day310.png" alt="" /></span></p>
<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;">　　Microsoft edge浏览器出现的错误</span></p>
<p><span style="font-size: 18px;"><img src="./images/搞Jedis案例出现问题，有大佬帮我看看怎么解决吗？先感谢大佬点进来看了---Day311.png" alt="" /></span></p>
<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>下面是我的代码</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.domain;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Province {
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> id;
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">private</span><span style="color: #000000;"> String name;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> Province() {
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span> Province(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id, String name) {
</span><span style="color: #008080;">11</span>         <span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
</span><span style="color: #008080;">12</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">13</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">int</span><span style="color: #000000;"> getId() {
</span><span style="color: #008080;">16</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> id;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> setId(<span style="color: #0000ff;">int</span><span style="color: #000000;"> id) {
</span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">this</span>.id =<span style="color: #000000;"> id;
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String getName() {
</span><span style="color: #008080;">24</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> name;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> setName(String name) {
</span><span style="color: #008080;">28</span>         <span style="color: #0000ff;">this</span>.name =<span style="color: #000000;"> name;
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">30</span> 
<span style="color: #008080;">31</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">32</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String toString() {
</span><span style="color: #008080;">33</span>         <span style="color: #0000ff;">return</span> "Province{" +
<span style="color: #008080;">34</span>                 "id=" + id +
<span style="color: #008080;">35</span>                 ", name='" + name + '\'' +
<span style="color: #008080;">36</span>                 '}'<span style="color: #000000;">;
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span> }</span></code></pre>

<p><span style="font-size: 18px;"><strong>数据库类：</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.dao;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.domain.Province;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> ProvinceDao {
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> List&lt;Province&gt;<span style="color: #000000;"> findAll();
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> }</span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.dao.impl;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.dao.ProvinceDao;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.domain.Province;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.util.JDBCUtils;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.jdbc.core.BeanPropertyRowMapper;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> org.springframework.jdbc.core.JdbcTemplate;
</span><span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> ProvinceDaoImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> ProvinceDao {
</span><span style="color: #008080;">12</span>     <span style="color: #008000;">//</span><span style="color: #008000;">1.声明成员变量 jdbctemplement</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">private</span> JdbcTemplate template = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JdbcTemplate(JDBCUtils.getDataSource());
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">public</span> List&lt;Province&gt;<span style="color: #000000;"> findAll() {
</span><span style="color: #008080;">17</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.定义sql</span>
<span style="color: #008080;">18</span>         String sql = "select * from province "<span style="color: #000000;">;
</span><span style="color: #008080;">19</span>         <span style="color: #008000;">//</span><span style="color: #008000;">2.执行sql</span>
<span style="color: #008080;">20</span>         List&lt;Province&gt; list = template.query(sql, <span style="color: #0000ff;">new</span> BeanPropertyRowMapper&lt;Province&gt;(Province.<span style="color: #0000ff;">class</span><span style="color: #000000;">));
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> list;
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">23</span> }</span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>JDBC工具类</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.util;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.alibaba.druid.pool.DruidDataSourceFactory;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.sql.DataSource;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Properties;
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JDBCUtils {
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DataSource ds ;
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">static</span><span style="color: #000000;"> {
</span><span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">18</span>             <span style="color: #008000;">//</span><span style="color: #008000;">1.加载配置文件</span>
<span style="color: #008080;">19</span>             Properties pro = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Properties();
</span><span style="color: #008080;">20</span>             <span style="color: #008000;">//</span><span style="color: #008000;">使用ClassLoader加载配置文件，获取字节输入流</span>
<span style="color: #008080;">21</span>             InputStream is = JDBCUtils.<span style="color: #0000ff;">class</span>.getClassLoader().getResourceAsStream("druid.properties"<span style="color: #000000;">);
</span><span style="color: #008080;">22</span> <span style="color: #000000;">            pro.load(is);
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2.初始化连接池对象</span>
<span style="color: #008080;">25</span>             ds =<span style="color: #000000;"> DruidDataSourceFactory.createDataSource(pro);
</span><span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">28</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">29</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (Exception e) {
</span><span style="color: #008080;">30</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">31</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">35</span> <span style="color: #008000;">     * 获取连接池对象
</span><span style="color: #008080;">36</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">37</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> DataSource getDataSource(){
</span><span style="color: #008080;">38</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> ds;
</span><span style="color: #008080;">39</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">40</span> 
<span style="color: #008080;">41</span> 
<span style="color: #008080;">42</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">43</span> <span style="color: #008000;">     * 获取连接Connection对象
</span><span style="color: #008080;">44</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">45</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> Connection getConnection() <span style="color: #0000ff;">throws</span><span style="color: #000000;"> SQLException {
</span><span style="color: #008080;">46</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;">  ds.getConnection();
</span><span style="color: #008080;">47</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">48</span> }</span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>Jedis工具类</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.jedis;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> redis.clients.jedis.Jedis;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> redis.clients.jedis.JedisPool;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> redis.clients.jedis.JedisPoolConfig;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Properties;
</span><span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JedisPoolUtils {
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> JedisPool jedisPool;
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">static</span><span style="color: #000000;">{
</span><span style="color: #008080;">15</span>         <span style="color: #008000;">//</span><span style="color: #008000;">读取配置文件</span>
<span style="color: #008080;">16</span>         InputStream is = JedisPoolUtils.<span style="color: #0000ff;">class</span>.getClassLoader().getResourceAsStream("jedis.properties"<span style="color: #000000;">);
</span><span style="color: #008080;">17</span>         <span style="color: #008000;">//</span><span style="color: #008000;">创建Properties对象</span>
<span style="color: #008080;">18</span>         Properties pro = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Properties();
</span><span style="color: #008080;">19</span>         <span style="color: #008000;">//</span><span style="color: #008000;">关联文件</span>
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">21</span> <span style="color: #000000;">            pro.load(is);
</span><span style="color: #008080;">22</span>         } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            e.printStackTrace();
</span><span style="color: #008080;">24</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">25</span>         <span style="color: #008000;">//</span><span style="color: #008000;">获取数据，设置到JedisPoolConfig中</span>
<span style="color: #008080;">26</span>         JedisPoolConfig config = <span style="color: #0000ff;">new</span><span style="color: #000000;"> JedisPoolConfig();
</span><span style="color: #008080;">27</span>         config.setMaxTotal(Integer.parseInt(pro.getProperty("maxTotal"<span style="color: #000000;">)));
</span><span style="color: #008080;">28</span>         config.setMaxIdle(Integer.parseInt(pro.getProperty("maxIdle"<span style="color: #000000;">)));
</span><span style="color: #008080;">29</span> 
<span style="color: #008080;">30</span>         <span style="color: #008000;">//</span><span style="color: #008000;">初始化JedisPool</span>
<span style="color: #008080;">31</span>         jedisPool = <span style="color: #0000ff;">new</span> JedisPool(config,pro.getProperty("host"),Integer.parseInt(pro.getProperty("port"<span style="color: #000000;">)));
</span><span style="color: #008080;">32</span> 
<span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span> 
<span style="color: #008080;">35</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">36</span> 
<span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">39</span> <span style="color: #008000;">     * 获取连接方法
</span><span style="color: #008080;">40</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">41</span>     <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span><span style="color: #000000;"> Jedis getJedis(){
</span><span style="color: #008080;">42</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> jedisPool.getResource();
</span><span style="color: #008080;">43</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">44</span> }</span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>service类</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.service;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.domain.Province;
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">interface</span><span style="color: #000000;"> ProvinceService {
</span><span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">public</span> List&lt;Province&gt;<span style="color: #000000;"> findAll();
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String findAllJson();
</span><span style="color: #008080;">11</span> }</span></code></pre>

<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.service.impl;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.dao.ProvinceDao;
</span><span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.dao.impl.ProvinceDaoImpl;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.domain.Province;
</span><span style="color: #008080;"> 6</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.jedis.JedisPoolUtils;
</span><span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.service.ProvinceService;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.core.JsonProcessingException;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> com.fasterxml.jackson.databind.ObjectMapper;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> redis.clients.jedis.Jedis;
</span><span style="color: #008080;">11</span> 
<span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.List;
</span><span style="color: #008080;">14</span> 
<span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> ProvinceServiceImpl <span style="color: #0000ff;">implements</span><span style="color: #000000;"> ProvinceService {
</span><span style="color: #008080;">16</span>     <span style="color: #008000;">//</span><span style="color: #008000;">声明dao</span>
<span style="color: #008080;">17</span>     <span style="color: #0000ff;">private</span> ProvinceDao dao = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ProvinceDaoImpl();
</span><span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">20</span>     <span style="color: #0000ff;">public</span> List&lt;Province&gt;<span style="color: #000000;"> findAll() {
</span><span style="color: #008080;">21</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> dao.findAll();
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>     <span style="color: #008000;">/**</span>
<span style="color: #008080;">25</span> <span style="color: #008000;">     使用redis缓存
</span><span style="color: #008080;">26</span>      <span style="color: #008000;">*/</span>
<span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span> <span style="color: #000000;">    @Override
</span><span style="color: #008080;">29</span>     <span style="color: #0000ff;">public</span><span style="color: #000000;"> String findAllJson() {
</span><span style="color: #008080;">30</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.先从redis中查询数据
</span><span style="color: #008080;">31</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.1获取redis客户端连接</span>
<span style="color: #008080;">32</span>         Jedis jedis =<span style="color: #000000;"> JedisPoolUtils.getJedis();
</span><span style="color: #008080;">33</span>         String province_json = jedis.get("province"<span style="color: #000000;">);
</span><span style="color: #008080;">34</span> 
<span style="color: #008080;">35</span>         <span style="color: #008000;">//</span><span style="color: #008000;">2判断 province_json 数据是否为null</span>
<span style="color: #008080;">36</span>         <span style="color: #0000ff;">if</span>(province_json == <span style="color: #0000ff;">null</span> || province_json.length() == 0<span style="color: #000000;">){
</span><span style="color: #008080;">37</span>             <span style="color: #008000;">//</span><span style="color: #008000;">redis中没有数据</span>
<span style="color: #008080;">38</span>             System.out.println("redis中没数据，查询数据库..."<span style="color: #000000;">);
</span><span style="color: #008080;">39</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2.1从数据中查询</span>
<span style="color: #008080;">40</span>             List&lt;Province&gt; ps =<span style="color: #000000;"> dao.findAll();
</span><span style="color: #008080;">41</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2.2将list序列化为json</span>
<span style="color: #008080;">42</span>             ObjectMapper mapper = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ObjectMapper();
</span><span style="color: #008080;">43</span>             <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
</span><span style="color: #008080;">44</span>                 province_json =<span style="color: #000000;"> mapper.writeValueAsString(ps);
</span><span style="color: #008080;">45</span>             } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (JsonProcessingException e) {
</span><span style="color: #008080;">46</span> <span style="color: #000000;">                e.printStackTrace();
</span><span style="color: #008080;">47</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">48</span> 
<span style="color: #008080;">49</span>             <span style="color: #008000;">//</span><span style="color: #008000;">2.3 将json数据存入redis</span>
<span style="color: #008080;">50</span>             jedis.set("province"<span style="color: #000000;">,province_json);
</span><span style="color: #008080;">51</span>             <span style="color: #008000;">//</span><span style="color: #008000;">归还连接</span>
<span style="color: #008080;">52</span> <span style="color: #000000;">            jedis.close();
</span><span style="color: #008080;">53</span> 
<span style="color: #008080;">54</span>         }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
</span><span style="color: #008080;">55</span>             System.out.println("redis中有数据，查询缓存..."<span style="color: #000000;">);
</span><span style="color: #008080;">56</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">57</span> 
<span style="color: #008080;">58</span> 
<span style="color: #008080;">59</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> province_json;
</span><span style="color: #008080;">60</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">61</span> }</span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>servlet类</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">package</span><span style="color: #000000;"> cn.local.web.servlet;
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.service.ProvinceService;
</span><span style="color: #008080;"> 5</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> cn.local.service.impl.ProvinceServiceImpl;
</span><span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.ServletException;
</span><span style="color: #008080;"> 8</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.annotation.WebServlet;
</span><span style="color: #008080;"> 9</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServlet;
</span><span style="color: #008080;">10</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletRequest;
</span><span style="color: #008080;">11</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> javax.servlet.http.HttpServletResponse;
</span><span style="color: #008080;">12</span> <span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> @WebServlet("/provinceServlet"<span style="color: #000000;">)
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span> ProvinceServlet <span style="color: #0000ff;">extends</span><span style="color: #000000;"> HttpServlet {
</span><span style="color: #008080;">16</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doPost(HttpServletRequest request, HttpServletResponse response) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
</span><span style="color: #008080;">17</span>        <span style="color: #008000;">/*</span><span style="color: #008000;"> //1.调用service查询
</span><span style="color: #008080;">18</span> <span style="color: #008000;">        ProvinceService service = new ProvinceServiceImpl();
</span><span style="color: #008080;">19</span> <span style="color: #008000;">        List&lt;Province&gt; list = service.findAll();
</span><span style="color: #008080;">20</span> <span style="color: #008000;">        //2.序列化list为json
</span><span style="color: #008080;">21</span> <span style="color: #008000;">        ObjectMapper mapper = new ObjectMapper();
</span><span style="color: #008080;">22</span> <span style="color: #008000;">        String json = mapper.writeValueAsString(list);</span><span style="color: #008000;">*/</span>
<span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span>         <span style="color: #008000;">//</span><span style="color: #008000;">1.调用service查询</span>
<span style="color: #008080;">25</span>         ProvinceService service = <span style="color: #0000ff;">new</span><span style="color: #000000;"> ProvinceServiceImpl();
</span><span style="color: #008080;">26</span>         String json =<span style="color: #000000;"> service.findAllJson();
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span> <span style="color: #000000;">        System.out.println(json);
</span><span style="color: #008080;">30</span>         <span style="color: #008000;">//</span><span style="color: #008000;">3.响应结果</span>
<span style="color: #008080;">31</span>         response.setContentType("application/json;charset=utf-8"<span style="color: #000000;">);
</span><span style="color: #008080;">32</span> <span style="color: #000000;">        response.getWriter().write(json);
</span><span style="color: #008080;">33</span> 
<span style="color: #008080;">34</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">35</span> 
<span style="color: #008080;">36</span>     <span style="color: #0000ff;">protected</span> <span style="color: #0000ff;">void</span> doGet(HttpServletRequest request, HttpServletResponse response) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> ServletException, IOException {
</span><span style="color: #008080;">37</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.doPost(request, response);
</span><span style="color: #008080;">38</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">39</span> }</span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>Html文件</strong></span></p>
<src class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>Title<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="js/jquery-3.3.1.min.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">
        $(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {

            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">发送ajax请求，加载所有省份数据</span>
<span style="background-color: #f5f5f5; color: #000000;">            $.get(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">provinceServlet</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,{},</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> (data) {
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">[{"id":1,"name":"北京"},{"id":2,"name":"上海"},{"id":3,"name":"广州"},{"id":4,"name":"陕西"}]</span>

                <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">1.获取select</span>
                <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> province </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> $(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#province</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">2.遍历json数组</span>
<span style="background-color: #f5f5f5; color: #000000;">                $(data).each(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> () {
                    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">3.创建&lt;option&gt;</span>
                    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> option </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;option name='</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.id</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">'&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.name</span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;/option&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;

                    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">4.调用select的append追加option</span>
<span style="background-color: #f5f5f5; color: #000000;">                    province.append(option);
                });


            });

        });


    </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>



<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="province"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>--请选择省份--<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></span></code></pre>

<p><span style="font-size: 18px;">&nbsp;</span></p>
<p><span style="font-size: 18px;"><strong>配置文件</strong></span></p>
<pre><code><span style="font-size: 18px;">driverClassName=com.mysql.jdbc.Driver</span><br /><span style="font-size: 18px;">url=jdbc:mysql:///jedis</span><br /><span style="font-size: 18px;">username=root</span><br /><span style="font-size: 18px;">password=root</span><br /><span style="font-size: 18px;">initialSize=5</span><br /><span style="font-size: 18px;">maxActive=10</span><br /><span style="font-size: 18px;">maxWait=3000</span><br /><br /><br /></code></pre>
<pre><code><span style="font-size: 18px;">host=localhost</span><br /><span style="font-size: 18px;">port=6379</span><br /><span style="font-size: 18px;">maxTotal=50</span><br /><span style="font-size: 18px;">maxIdle=10</span></code></pre>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>