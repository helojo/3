<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Caused by com.rabbitmq.client.ShutdownSignalException channel error; protocol method #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg &#39;type&#39; for exchange &#39;me' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Caused by com.rabbitmq.client.ShutdownSignalException channel error; protocol method #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg &#39;type&#39; for exchange &#39;me</center></div><div class='banquan'>原文出处:本文由博客园博主侧身左睡提供。<br/>
原文连接:https://www.cnblogs.com/xyfer1018/p/11582814.html</div><br>
    <p>在启动RabbitMQ消费端的时候报错：Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'type' for exchange 'messageChange' in vhost '/': received 'fanout' but current is 'direct', class-id=40, method-id=10)</p>
<p>&nbsp;详细信息如下：</p>
<src class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> F:\jdk1.8.0_151\bin\java.exe "-javaagent:E:\IntelliJ IDEA 2019.2.1\lib\idea_rt.jar=56252:E:\IntelliJ IDEA 2019.2.1\bin" -Dfile.encoding=UTF-8 -classpath F:\jdk1.8.0_151\jre\lib\charsets.jar;F:\jdk1.8.0_151\jre\lib\deploy.jar;F:\jdk1.8.0_151\jre\lib\ext\access-bridge-64.jar;F:\jdk1.8.0_151\jre\lib\ext\cldrdata.jar;F:\jdk1.8.0_151\jre\lib\ext\dnsns.jar;F:\jdk1.8.0_151\jre\lib\ext\jaccess.jar;F:\jdk1.8.0_151\jre\lib\ext\jfxrt.jar;F:\jdk1.8.0_151\jre\lib\ext\localedata.jar;F:\jdk1.8.0_151\jre\lib\ext\nashorn.jar;F:\jdk1.8.0_151\jre\lib\ext\sunec.jar;F:\jdk1.8.0_151\jre\lib\ext\sunjce_provider.jar;F:\jdk1.8.0_151\jre\lib\ext\sunmscapi.jar;F:\jdk1.8.0_151\jre\lib\ext\sunpkcs11.jar;F:\jdk1.8.0_151\jre\lib\ext\zipfs.jar;F:\jdk1.8.0_151\jre\lib\javaws.jar;F:\jdk1.8.0_151\jre\lib\jce.jar;F:\jdk1.8.0_151\jre\lib\jfr.jar;F:\jdk1.8.0_151\jre\lib\jfxswt.jar;F:\jdk1.8.0_151\jre\lib\jsse.jar;F:\jdk1.8.0_151\jre\lib\management-agent.jar;F:\jdk1.8.0_151\jre\lib\plugin.jar;F:\jdk1.8.0_151\jre\lib\resources.jar;F:\jdk1.8.0_151\jre\lib\rt.jar;F:\workspace\rabbitmqDemo\rabbitmqConsumer02\target\test-classes;F:\repository_ssh\org\springframework\boot\spring-boot-starter-logging\2.1.0.RELEASE\spring-boot-starter-logging-2.1.0.RELEASE.jar;F:\repository_ssh\ch\qos\logback\logback-classic\1.2.3\logback-classic-1.2.3.jar;F:\repository_ssh\ch\qos\logback\logback-core\1.2.3\logback-core-1.2.3.jar;F:\repository_ssh\org\apache\logging\log4j\log4j-to-slf4j\2.11.1\log4j-to-slf4j-2.11.1.jar;F:\repository_ssh\org\apache\logging\log4j\log4j-api\2.11.1\log4j-api-2.11.1.jar;F:\repository_ssh\org\slf4j\jul-to-slf4j\1.7.25\jul-to-slf4j-1.7.25.jar;F:\repository_ssh\com\rabbitmq\amqp-client\5.7.0\amqp-client-5.7.0.jar;F:\repository_ssh\org\slf4j\slf4j-api\1.7.26\slf4j-api-1.7.26<span style="color: #000000;">.jar xyfer.Consumer01
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">java.io.IOException
</span><span style="color: #008080;"> 3</span>     at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:129<span style="color: #000000;">)
</span><span style="color: #008080;"> 4</span>     at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:125<span style="color: #000000;">)
</span><span style="color: #008080;"> 5</span>     at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:147<span style="color: #000000;">)
</span><span style="color: #008080;"> 6</span>     at com.rabbitmq.client.impl.ChannelN.exchangeDeclare(ChannelN.java:783<span style="color: #000000;">)
</span><span style="color: #008080;"> 7</span>     at com.rabbitmq.client.impl.recovery.AutorecoveringChannel.exchangeDeclare(AutorecoveringChannel.java:242<span style="color: #000000;">)
</span><span style="color: #008080;"> 8</span>     at com.rabbitmq.client.impl.recovery.AutorecoveringChannel.exchangeDeclare(AutorecoveringChannel.java:232<span style="color: #000000;">)
</span><span style="color: #008080;"> 9</span>     at com.rabbitmq.client.impl.recovery.AutorecoveringChannel.exchangeDeclare(AutorecoveringChannel.java:212<span style="color: #000000;">)
</span><span style="color: #008080;">10</span>     at com.rabbitmq.client.impl.recovery.AutorecoveringChannel.exchangeDeclare(AutorecoveringChannel.java:217<span style="color: #000000;">)
</span><span style="color: #008080;">11</span>     at xyfer.Consumer01.main(Consumer01.java:30<span style="color: #000000;">)
</span><span style="color: #ff0000;">12 Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'type' for exchange 'messageChange' in vhost '/': received 'fanout' but current is 'direct', class-id=40, method-id=10)
</span><span style="color: #008080;">13</span>     at com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:66<span style="color: #000000;">)
</span><span style="color: #008080;">14</span>     at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:36<span style="color: #000000;">)
</span><span style="color: #008080;">15</span>     at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:502<span style="color: #000000;">)
</span><span style="color: #008080;">16</span>     at com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:293<span style="color: #000000;">)
</span><span style="color: #008080;">17</span>     at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:141<span style="color: #000000;">)
</span><span style="color: #008080;">18</span>     ... 6<span style="color: #000000;"> more
</span><span style="color: #ff0000;">19 Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'type' for exchange 'messageChange' in vhost '/': received 'fanout' but current is 'direct', class-id=40, method-id=10)
</span><span style="color: #008080;">20</span>     at com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:522<span style="color: #000000;">)
</span><span style="color: #008080;">21</span>     at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:346<span style="color: #000000;">)
</span><span style="color: #008080;">22</span>     at com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:182<span style="color: #000000;">)
</span><span style="color: #008080;">23</span>     at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:114<span style="color: #000000;">)
</span><span style="color: #008080;">24</span>     at com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:672<span style="color: #000000;">)
</span><span style="color: #008080;">25</span>     at com.rabbitmq.client.impl.AMQConnection.access$300(AMQConnection.java:48<span style="color: #000000;">)
</span><span style="color: #008080;">26</span>     at com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:599<span style="color: #000000;">)
</span><span style="color: #008080;">27</span>     at java.lang.Thread.run(Thread.java:748<span style="color: #000000;">)
</span><span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span> Process finished with exit code -1</code></pre>

<p>仔细看一下报错信息：Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg 'type' for exchange 'messageChange' in vhost '/': received 'fanout' but current is 'direct', class-id=40, method-id=10)</p>
<p>大概意思是交换机的类型不匹配，消费端应该收到名称为&ldquo;messageChange&rdquo;，类型为&ldquo;fanout&rdquo;的交换机发送的消息，但是当前RabbitMQ中存在的名称为&ldquo;messageChange&rdquo;的交换机的类型却是&ldquo;direct&rdquo;，所以交换机的类型不匹配。</p>
<p>打开RabbitMQ可以看到确实是这样：</p>
<p><img src="./images/Caused by com.rabbitmq.client.ShutdownSignalException channel error; protocol method #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg &#39;type&#39; for exchange &#39;me0.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>目前有两种解决方式：</strong></p>
<p><strong>一、更改消费端代码中声明的交换机名称即可；</strong></p>
<p><strong>二，把RabbitMQ中的同名却不同类型的交换机删除即可；</strong></p>
<p>消费端代码如下，交换机名称为&ldquo;messageChange&rdquo;，类型为&ldquo;fanout&rdquo;；</p>
<src class="cnblogs_code">
<pre><code><span style="color: #0000ff;">package</span><span style="color: #000000;"> xyfer;

</span><span style="color: #0000ff;">import</span> com.rabbitmq.client.*<span style="color: #000000;">;

</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.concurrent.TimeoutException;

</span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> Consumer02 {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">Publish/subscribe发布订阅模式</span>
    <span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">final</span> String QUEUE_SMS ="queueSms"<span style="color: #000000;">;
    </span><span style="color: #ff0000;">private static final String EXCHANGE = "messageChange";   同名
    </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> main(String[] args) {
        Connection connection </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        Channel channel </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;
        </span><span style="color: #0000ff;">try</span><span style="color: #000000;"> {
            ConnectionFactory connectionFactory </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> ConnectionFactory();
            connectionFactory.setHost(</span>"127.0.0.1"<span style="color: #000000;">);
            connectionFactory.setPort(</span>5672<span style="color: #000000;">);
            connection </span>=<span style="color: #000000;"> connectionFactory.newConnection();
            channel </span>=<span style="color: #000000;"> connection.createChannel();
            </span><span style="color: #008000;">//</span><span style="color: #008000;">通道绑定交换机</span>
            <span style="color: #008000;">/**</span><span style="color: #008000;">
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;参数明细
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;1、交换机名称
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;2、交换机类型，fanout、topic、direct、headers
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000;">*/</span>
            <span style="color: #008000;">//</span><span style="color: #008000;">Publish/subscribe发布订阅模式</span>
<span style="color: #ff0000;">            channel.exchangeDeclare(EXCHANGE, BuiltinExchangeType.FANOUT);   不同类型
            </span><span style="color: #008000;">//</span><span style="color: #008000;">通道绑定队列</span>
            <span style="color: #008000;">/**</span><span style="color: #008000;">
             * 声明队列，如果Rabbit中没有此队列将自动创建
             * param1:队列名称
             * param2:是否持久化
             * param3:队列是否独占此连接
             * param4:队列不再使用时是否自动删除此队列
             * param5:队列参数
             * String queue, boolean durable, boolean exclusive, boolean autoDelete, Map&lt;String, Object&gt; arguments
             *
             </span><span style="color: #008000;">*/</span><span style="color: #000000;">
            channel.queueDeclare(QUEUE_SMS,</span><span style="color: #0000ff;">true</span>,<span style="color: #0000ff;">false</span>,<span style="color: #0000ff;">false</span>,<span style="color: #0000ff;">null</span>);<span style="color: #008000;">//</span><span style="color: #008000;">通道绑定短信队列
            </span><span style="color: #008000;">//</span><span style="color: #008000;">交换机和队列绑定</span>
            <span style="color: #008000;">/**</span><span style="color: #008000;">
             * 参数明细
             * 1、队列名称
             * 2、交换机名称
             * 3、路由key
             </span><span style="color: #008000;">*/</span>
            <span style="color: #008000;">//</span><span style="color: #008000;">Publish/subscribe发布订阅模式</span>
            channel.queueBind(QUEUE_SMS,EXCHANGE,""<span style="color: #000000;">);
            DefaultConsumer consumer </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> DefaultConsumer(channel) {
                </span><span style="color: #008000;">/**</span><span style="color: #008000;">
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;消费者接收消息调用此方法
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="color: #808080;">@param</span><span style="color: #008000;">&nbsp;consumerTag&nbsp;消费者的标签，在channel.basicConsume()去指定
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="color: #808080;">@param</span><span style="color: #008000;">&nbsp;envelope&nbsp;消息包的内容，可从中获取消息id，消息routingkey，交换机，消息和重传标志
                    (收到消息失败后是否需要重新发送)
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="color: #808080;">@param</span><span style="color: #008000;">&nbsp;properties
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="color: #808080;">@param</span><span style="color: #008000;">&nbsp;body
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span style="color: #808080;">@throws</span><span style="color: #008000;">&nbsp;IOException
                 * String consumerTag, Envelope envelope, BasicProperties properties, byte[] body
                 </span><span style="color: #008000;">*/</span><span style="color: #000000;">
                @Override
                </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">void</span> handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span style="color: #0000ff;">byte</span>[] body) <span style="color: #0000ff;">throws</span><span style="color: #000000;"> IOException {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">交换机</span>
                    String exchange =<span style="color: #000000;"> envelope.getExchange();
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">路由key</span>
                    String routingKey =<span style="color: #000000;"> envelope.getRoutingKey();
                    envelope.getDeliveryTag();
                    String msg </span>= <span style="color: #0000ff;">new</span> String(body,"utf-8"<span style="color: #000000;">);
                    System.out.println(</span>"mq收到的消息是："+<span style="color: #000000;">msg );
                }

            };
            System.out.println(</span>"消费者启动成功！"<span style="color: #000000;">);
            channel.basicConsume(QUEUE_SMS,</span><span style="color: #0000ff;">true</span><span style="color: #000000;">,consumer);

        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (IOException e) {
            e.printStackTrace();
        } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (TimeoutException e) {
            e.printStackTrace();
        }
    }
}</span></code></pre>

<p>&nbsp;</p>

</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>